# كيفية تصميم أصغر نظام لمتحكم وحيد الشريحة

سيتم شرح هذا الموضوع باستخدام متحكم وحيد الشريحة STM32 (سلسلة F1).

## الخلفية

عندما نتعلم النظم المضمنة ، نبدأ عادةً من متحكم وحيد الشريحة. عند تعلم متحكم وحيد الشريحة ، لا يمكننا التركيز فقط على البرمجيات ، بل يجب أن نتعلم أيضًا المعرفة الأساسية للأجهزة. التصميم الجيد هو تصميم يجمع بين البرمجيات والأجهزة.

عند الحديث عن تصميم الأجهزة لمتحكم وحيد الشريحة ، نقوم بتقليصه إلى أصغر نظام يمكن تحقيقه ، وهو التصميم الأبسط الذي يمكن تحقيقه لتنفيذ الوظائف الأساسية. باستخدام متحكم وحيد الشريحة STM32 (سلسلة F1) كمثال ، لا يوجد أصغر من هذه الأجزاء: **الطاقة والإعادة التعيين والساعة ووضع التشغيل والتصحيح**.

![](https://img.wiki-power.com/d/wiki-media/img/20200605234144.jpg)

## الطاقة

يوجد عدة أنواع من الطاقة المتاحة لـ STM32:

### الطاقة الرئيسية (VDD / VSS)

تشير الطاقة الرئيسية إلى المداخل الموسومة بـ VDD1 و VDD2 ... وما إلى ذلك.  
يجب وضع مكثف تصفية 100nF على كل مدخل ووضعه بأقرب مكان ممكن من المدخل. بالإضافة إلى ذلك ، يجب استخدام مكثف تانتالوم مشترك بسعة 10uF.

![](https://img.wiki-power.com/d/wiki-media/img/20200605163136.png)

![](https://img.wiki-power.com/d/wiki-media/img/20200605163204.png)

### الطاقة الاحتياطية (VBAT)

يمكن استخدام مدخل VBAT لتزويد الطاقة من البطارية. إذا لم يتم استخدامه ، فيمكن توصيله بـ VDD. يجب وضع مكثف تصفية 100nF على VBAT أيضًا.  
يمكن الرجوع إلى دائرة اختيار الطاقة التالية:

![](https://img.wiki-power.com/d/wiki-media/img/20200605163337.jpg)

### الطاقة ADC (VDDA / VSSA)

لتحسين دقة التحويل ، يمكن لجهاز ADC الحصول على الطاقة من هنا. عادةً ما يتم توصيل VDDA بـ VDD عبر ملف حثي.

إذا لم يتم استخدام ADC ، فيمكن توصيل VDD و VDDA و VREF + (إذا كان موجودًا) معًا ، وتوصيل مكثف تانتالوم بسعة 1uF ومكثف سيراميك 10nF بالأرض للتصفية.

## الإعادة التعيين

نظرًا لوجود مقاومات سحب عالية داخل STM32 ، يكفي توصيل مكثف تصفية 100nF + زر خارجي:

![](https://img.wiki-power.com/d/wiki-media/img/20200605163429.png)

عند التشغيل ، يكون المعالج المركزي في وضع الإعادة التعيين ، وفي هذا الوقت يتم شحن المكثف ، ويتم سحب الجهد على مدخل NRST بشكل مستمر. عندما يتم شحن المكثف بالكامل ، يتحول الجهد على NRST إلى مستوى عالٍ ، وفي هذه الحالة يخرج المعالج المركزي من وضع الإعادة التعيين ويدخل وضع التشغيل العادي. عند الضغط على الزر ، يتم تفريغ المكثف وإعادة شحنه عندما يتم الافراج عن الزر ، ويتم تنشيط الإعادة التعيين.

وفقًا لدليل التصميم الرسمي ، يكفي اختيار مكثف 100nF لضمان أن الجهد المنخفض على NRST يستمر لفترة تلبي متطلبات النبضة الدنيا لإعادة التعيين ، ويمكن تنشيط الإعادة التعيين بشكل صحيح.

إذا لم يكن هناك حاجة لوظيفة الإعادة التعيين اليدوية ، فيمكن تجاهل الزر.

## الساعة

![](https://img.wiki-power.com/d/wiki-media/img/20200605155729.png)

كما هو موضح في الشكل أعلاه ، تنقسم ساعة STM32 إلى الأنواع التالية:

1. **HSI**: ساعة داخلية عالية السرعة ، هي مولد اهتزاز داخلي ، تردد 8 ميجاهرتز
2. **HSE**: ساعة خارجية عالية السرعة ، يمكن توصيلها بمولد اهتزازي بلوري / سيراميك ، أو يمكن توصيلها بمصدر ساعة خارجي ، وتتراوح الترددات بين 4 ميجاهرتز و 16 ميجاهرتز
3. **LSI**: ساعة داخلية منخفضة السرعة ، مولد اهتزاز داخلي ، تردد 40 كيلوهرتز. يمكن استخدامه كمصدر ساعة لمراقبة الوقت الحقيقي (RTC) ومراقبة الوقت الحقيقي (WDT).
4. **LSE**: ساعة خارجية منخفضة السرعة ، توصيلها بمولد اهتزازي بلوري بتردد 32.768 كيلوهرتز. يستخدم LSE كمصدر ساعة لمراقبة الوقت الحقيقي (RTC).
5. **PLL**: مضاعف الساعة ، يمكن اختيار مصدر الساعة الداخلية HSI / 2 أو HSE أو HSE / 2. يمكن أن يكون مضاعف التردد من 2 إلى 16 مرة ، ولكن يجب ألا يتجاوز التردد الأقصى للإخراج 72 ميجاهرتز.



من الناحية الاستقرارية ، عند التصميم ، نستخدم عادة المراوح الكهربائية الخارجية كمصدر للساعة. **عادةً ما يتم اختيار مروحة كهربائية خارجية بسرعة 8 ميجاهرتز كـ HSE** ، لتسهيل التضاعف (عادةً ما يتم التضاعف إلى 72 ميجاهرتز) ؛ **يتم اختيار مروحة كهربائية خارجية بسرعة 32.768 كيلوهرتز كـ LSE** ، ويتم استخدام RTC لتسهيل التقسيم (32768 هو 2 ^ 15 ، ويمكن الحصول على وقت دقيق).

فيما يتعلق باختيار المراوح الكهربائية ، فإن النشطة لديها دقة عالية ، والغير نشطة لديها تكلفة منخفضة ، وعادةً ما يكون الغير نشط كافيًا.  
إذا تم اختيار مروحة كهربائية غير نشطة ، فيجب إضافة مكثف التشغيل على كلا الطرفين لتصفية التداخلات الكهرومغناطيسية العالية في موجات المراوح الكهربائية. يمكن اختيار السعة بين 10 و 40 بيكوفاراد.

يمكن إضافة مقاومة 1 ميجا بين دخل وخرج المراوح الكهربائية لتوليد رد فعل سلبي وضمان عمل المكبر في منطقة الزيادة العالية الخطية. يؤدي أيضًا إلى تيار محدود لمنع تلف المراوح الكهربائية بسبب تحميل المقوم العكسي.

![](https://img.wiki-power.com/d/wiki-media/img/20200605171011.png)

![](https://img.wiki-power.com/d/wiki-media/img/20200612130149.jpg)

## تكوين وضع البدء

**عادةً ما يتم سحب دبوس BOOT0** (متصل بمقاومة 10 كيلو أوم ثم متصل بالأرض) ، **BOOT1 أي**.

إذا كنت بحاجة إلى تبديل الوضع ، فيمكنك الرجوع إلى التصميم التالي:

![](https://img.wiki-power.com/d/wiki-media/img/20200605163537.png)

يمكن الرجوع إلى وضع البدء في [**وضع البدء لـ STM32**](https://wiki-power.com/ar/وضع البدء لـ STM32)

## واجهة التنزيل والتصحيح

عادةً ما نستخدم واجهة SWD (أقل عدد من الأسلاك ، وسهلة الاستخدام) ، **يمكن توصيل SWDIO و SWCLK و VCC و GND مباشرةً**.  
لا يلزم إضافة مقاومة سحب عالية / منخفضة خارجية ، لأن STM32 مدمج بها بالفعل.

![](https://img.wiki-power.com/d/wiki-media/img/20200605170741.png)

## خلاصة

هذا هو تصميم دائرة STM32 (سلسلة F1) الأصغر. يمكن الرجوع إلى المستندات الرسمية والمقالات ذات الصلة لمزيد من التفاصيل.

## المراجع والشكر

- [طريقة تصميم الأجهزة لمتحكمات STM32F1](https://blog.csdn.net/Creative_Team/article/details/80006705?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-7)
- [تصميم الأجهزة STM32](https://cedar-renjun.github.io/2015/12/12/STM32-Hardware-Design/)
- [نظام الساعة STM32](http://blog.chinaunix.net/uid-24219701-id-4081961.html)
- "AN2586 دليل التطبيق - دليل المبتدئين لاستخدام تطوير الأجهزة STM32F10xxx"
- "AN2867 دليل التطبيق - دليل تصميم دوائر المراوح الكهربائية لمتحكمات ST Microcontrollers"

> عنوان النص: <https://wiki-power.com/>  
> يتم حماية هذا المقال بموجب اتفاقية [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh)، يُرجى ذكر المصدر عند إعادة النشر.

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
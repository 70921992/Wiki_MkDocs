# RobotCtrl - مجموعة تطوير عامة لـ STM32

![](https://img.wiki-power.com/d/wiki-media/img/20220416181125.jpeg)

مستودع المشروع: [**linyuxuanlin/RobotCtrl**](https://github.com/linyuxuanlin/RobotCtrl)

يحتوي RobotCtrl - STM32 通用开发套件 على ثلاثة لوحات:

- [**RobotCtrl_Core - 核心板**](https://wiki-power.com/ar/RobotCtrl_Core-%E6%A0%B8%E5%BF%83%E6%9D%BF)
- [**RobotCtrl_Core - 外设拓展板**](https://wiki-power.com/ar/RobotCtrl_Func-%E5%A4%96%E8%AE%BE%E6%8B%93%E5%B1%95%E6%9D%BF)
- [**RobotCtrl_Power - 电源供电板**](https://wiki-power.com/ar/RobotCtrl_Power-%E7%94%B5%E6%BA%90%E4%BE%9B%E7%94%B5%E6%9D%BF)

## متطلبات التصميم

![](https://img.wiki-power.com/d/wiki-media/img/20220527111854.png)

ملاحظة: ما يلي هو ملخص التصميم ، يرجى الرجوع إلى المقالات ذات الصلة للحصول على المحتوى الكامل.

### فكرة تصميم RobotCtrl_Core

يتضمن تصميم المخطط الأساسي لـ RobotCtrl_Core دائرة الطاقة والنظام الأدنى للميكروكنترولر والاتصال USB وموصل B2B وأزرار المستخدم والمصابيح الخلفية.

تستخدم دائرة الطاقة LDO ، ويكون ميزتها بساطة الدائرة وتموج الإخراج الصغير والتكلفة المنخفضة ومساحة التخطيط الصغيرة. بالإضافة إلى السعة المناسبة للتخلص من الضوضاء ومؤشر الطاقة ، يتم تحويل الجهد المستقر الذي يتم إدخاله من منفذ USB أو موصل B2B إلى 3.3 فولت (بحد أقصى 1 أمبير).

في التصميم الأدنى للنظام ، يتم إدخال الطاقة بواسطة مصدر طاقة 3.3 فولت ويتم إزالة الضوضاء بالسعات المناسبة. بالإضافة إلى ذلك ، يتم توصيل مصدر الطاقة المخصص لـ ADC VDDA بـ VDD عن طريق محبس مغناطيسي 120Ω ويتم إضافة سعات إزالة إضافية. يتم إضافة زر إعادة التعيين الخارجي لدائرة الإعادة التعيين ، ويتم تشغيل NRST عندما يكون الجهد المنخفض لإعادة تعيين النظام. يتم توصيل دائرة الساعة بمصدر ساعة خارجي HSE ، ويتم توصيله من خلال OSC_IN و OSC_OUT إلى مولد الكريستال السلبي. يتم اختيار وضع التشغيل الافتراضي لتشغيل الذاكرة الفلاش المدمجة ، أي BOOT0 هو منخفض و BOOT1 هو أي مستوى ، ويتم سحب BOOT0 إلى الأرض باستخدام مقاومة 10 كيلو أوم. يتم توصيل دائرة التنزيل والتصحيح مباشرةً بواجهة SW (DIO / CLK).

تصميم دائرة الاتصال USB ، يحتوي STM32F4 على جهاز USB مدمج. يتم استخدام موصل USB Micro الخارجي ، ويتم توصيل مقاومة تيار الحد الأقصى 10 أوم في الخطوط البيانية والخطوط الكهربائية ، ويتم إضافة تلفزيونات وثنائيات الصمام الثنائي الساكن على الخطوط البيانية والخطوط الكهربائية لتلبية متطلبات EMC.

يستخدم موصل B2B لتوفير إمدادات الطاقة والاتصالات بين RobotCtrl_Func. في هذا التصميم ، يكفي موصلان B2B لتوصيل جميع IO لميكروكنترولر STM32F407ZE ، مما يعزز قابلية التوسع في المرحلة اللاحقة.

### فكرة تصميم RobotCtrl_Func

يتضمن تصميم المخطط الأساسي لـ RobotCtrl_Func الاتصال التسلسلي (RS-232 / TTL) والاتصال CAN والاتصال Ethernet ومستشعر الاتجاه وواجهة الموجات فوق الصوتية وواجهة القياس بالأشعة تحت الحمراء (مع عزل الضوء) والجرس وواجهة التنزيل والتصحيح SW وأزرار المستخدم والمصابيح الخلفية وواجهة GPIO العامة والطاقة وموصل B2B وغيرها من الوحدات.

توفر دائرة الاتصال التسلسلي واجهة مستوى TTL و RS-232. يتم استخدام USART1 و UART5 مباشرةً لـ TTL ، بينما يتم استخدام دائرة الاتصال RS-232 لتحويل TTL الميكروكنترولر إلى مستوى RS-232. لتحسين أداء EMC ، يتم توصيل الدائرة الخارجية لموصل DB9 بتلفزيونات ثنائيات الصمام الثنائي الساكن على الأرض ، ويتطلب تحويل TTL إلى RS-232 مصدر طاقة إضافي للتخلص من الضوضاء والسعات الذاتية.

يتم بناء دائرة الاتصال CAN على أساس رقاقة الاستقبال والإرسال CAN ، ويتم نقلها عبر مستوى الجهد المختلف CAN. يجب إضافة مقاومة 120 أومًا على نهاية الحافلة CAN لتوافق الانتهاء وتقليل انعكاس الإشارة.

يعتمد التواصل عبر Ethernet على شريحة PHY Ethernet واستخدام واجهة RMII للتواصل مع الميكروكنترولر، ويتم التواصل عبر كابل Ethernet متصل بمنفذ RJ45 الذي يحتوي على محول عزل مدمج. يتم استخدام مذبذب غير نشط خارجي بتردد 25 ميجاهرتز لساعة دائرة Ethernet ويتطلب توفير طاقة مستقلة لتقليل التداخل الكهربائي، ويتم استخدام نفس مصدر الطاقة الخطي المنخفض الانحراف الذي يستخدمه اللوحة الأساسية لتوفير الطاقة لدائرة Ethernet.

تعتمد دائرة واجهة أربعة أجهزة استشعار للتحكم عن بعد على استخدام مستشعرات الأشعة تحت الحمراء التي تعمل بجهد 12 فولت وإشارة (نوع NPN المفتوح باستمرار)، لذلك يتم توفير الطاقة بجهد 12 فولت من RobotCtrl_Power ويتم إضافة أربعة شرائح عزل الضوء لنقل إشارات الجهد العالي والجهد المنخفض. يتطلب تصميم دائرة عزل الضوء حساب مقاومة الحد الأقصى لتدفق الكهرباء والتأكد من الحفاظ على الجهد المحدد في دليل البيانات. تم استخدام وحدة استشعار الاتجاه MPU6050 في تصميم وحدة استشعار الاتجاه، وتم تخصيص واجهة I2C للتواصل مع الميكروكنترولر.

### تصميم RobotCtrl_Power

يتكون تصميم مخطط RobotCtrl_Power بشكل رئيسي من مدخل طاقة XT60 ثنائي، دائرة تحويل الجهد من 24 فولت إلى 12 فولت، دائرة تحويل الجهد من 24 فولت إلى 5 فولت، ومفتاح التمكين ومؤشر الطاقة ودائرة الحماية من الانعكاس والجهد الزائد وغيرها.

تم استخدام مقبس XT60 مزدوج للمدخلات الكهربائية، حيث يتم استخدام أحدهما لإدخال الطاقة ويمكن استخدام الآخر كمصدر طاقة احتياطي أو كمخرج للبطارية للاستخدام الخارجي.

تم استخدام دائرة حماية MOS لمنع الانعكاس. في حالة توصيل الطاقة بشكل صحيح، يتم توصيل MOS، وفي حالة الانعكاس، يتم فصله لحماية الدائرة. في هذا التصميم، تم استخدام MOS P-MOS المحلي للحماية من الانعكاس، وتم استخدام مقاومة التقسيم والتوصيل الثنائي لتأمين الجهد البوابي الذي يتم توصيله بالتوصيل الثنائي الثابت. لتحقيق الحماية من الجهد الزائد وحماية ESD، تم توصيل توصيلات TVS ثنائية في نهاية المدخل.

تم استخدام مصدر طاقة Buck غير معزول يعتمد على LMR14050 لتصميم دائرة تحويل الجهد 12 فولت / 5 فولت. وفقًا لمبدأ Buck ومرجع دليل بيانات رقاقة التحويل، تم اختيار قيمة مقاومة التغذية الراجعة وحساب النسبة للحفاظ على الإخراج عند 12 فولت / 5 فولت. عند اختيار نوع الملف الحثي، يجب مراعاة أن الحد الأقصى لتيار التشبع يجب أن يكون أكبر من التيار المتذبذب ويجب ترك مساحة فارغة؛ يجب اختيار شريحة شوتكي لتحقيق التبديل السريع، ويجب أن تتوافق الجهد والتيار مع متطلبات الدائرة. بالإضافة إلى ذلك، يجب توصيل مكثفات التحويل الكبيرة والصغيرة على المدخل والمخرج لتصفية التداخل.

يمكن التحكم في تشغيل وإيقاف تشغيل الإخراج المستقر باستخدام مفتاح التمكين، وتم توصيل دبوس التمكين الخاص برقاقة Buck لتحقيق التشغيل الناعم والإيقاف الناعم للإخراج المستقر. يمكن لمؤشر الطاقة إشعار المستخدم بحالة الإخراج المستقر بجهد 12 فولت / 5 فولت.

## المراجع والشكر

![](https://img.wiki-power.com/d/wiki-media/img/20220416181139.jpeg)

هذا المشروع هو مشروع تخرجي الشخصي، وواجهت العديد من المشاكل الصغيرة والكبيرة خلال تصميم المشروع ولحامه وتصحيحه. بفضل مساعدة المشرف والزملاء والأصدقاء، تم الانتهاء من المشروع بنجاح وحصلت على شهادة تخرج ممتازة. شكرا لكم!

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
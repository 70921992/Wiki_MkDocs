# استخدام acme.sh لتطبيق تلقائي لشهادة النطاق (Docker Synology)

يوضح هذا المقال كيفية استخدام صورة Docker acme.sh لتحقيق وظيفة تطبيق وتجديد تلقائي للشهادة.

يمكن لـ [**acme.sh**](https://github.com/acmesh-official/acme.sh) إنشاء شهادات مجانية من letsencrypt ، ويدعم نشر Docker ، ويدعم طريقتي التحقق من النطاق http و DNS ، بما في ذلك الوضع اليدوي والوضع الآلي لـ DNS ووضع DNS alias لتلبية جميع البيئات والاحتياجات. يمكن تطبيق شهادات النطاق الفردي وشهادات النطاق العام ، وتجديد الشهادة تلقائيًا ونشرها في المشروع.

## إعداد API DNS

يستخدم هذا المقال Tencent Cloud كمثال لتطبيق API DNS ، ويمكن الرجوع إلى الوثائق الرسمية [**dnsapi**](https://github.com/acmesh-official/acme.sh/wiki/dnsapi) للحصول على منصات أخرى.

أولاً ، افتح [**DNSPOD**](https://console.dnspod.cn/) ، ثم انقر فوق الصورة الرمزية في الزاوية العلوية اليمنى - `إدارة المفاتيح`

ثم ، أنشئ مفتاحًا جديدًا وانسخ **ID** و **Token**.

## نشر على Docker Synology

يوضح هذا البرنامج التعليمي وضع الخادم الخلفي لـ Docker ، والذي يعمل باستمرار على الحاويات لتحقيق وظيفة تجديد تلقائي للشهادة عند انتهاء صلاحيتها.

### إنشاء مجلد التكوين

أولاً وقبل كل شيء ، يتم إنشاء مجلد `/docker/acme.sh` ، ثم يتم إنشاء ملف `account.conf` يدويًا:

![](https://img.wiki-power.com/d/wiki-media/img/20210430212420.png)

ثم ، يتم تحرير هذا الملف يدويًا وإضافة هذه الأسطر:

```conf
export DP_Id="ID المنح الجديد"
export DP_Key="رمز المنح الجديد"
AUTO_UPGRADE='1'
```

ثم يتم حفظ الملف وإغلاقه.

### تنزيل الصورة وتكوين الحاوية

افتح حزمة Synology Docker وقم بتنزيل صورة `neilpang/acme.sh` ، ثم انقر نقرًا مزدوجًا للبدء والانتقال إلى `الإعدادات المتقدمة`

في صفحة `الحجم` ، يتم تكوين مجلد التثبيت ، ويتم اختيار `إضافة مجلد` ، ويتم اختيار مسار `docker/acme.sh` المحلي ، ويتم ملؤه بالمسار `/acme.sh` (الافتراضي غير قابل للتغيير):

![](https://img.wiki-power.com/d/wiki-media/img/20210430214221.png)

في صفحة `الشبكة` ، يتم تحديد "استخدام نفس الشبكة المستخدمة في Docker Host".

ثم ، يتم التبديل إلى صفحة `البيئة` ، ويتم إدخال الأمر `daemon` في مربع الأوامر:

![](https://img.wiki-power.com/d/wiki-media/img/20210430215244.png)

ثم يتم إنشاء وتشغيل الحاوية. يتم النقر نقرًا مزدوجًا على الحاوية التي تم تشغيلها ، ثم يتم التبديل إلى صفحة `محطة الطرفية` ، ويتم النقر فوق `بدء عن طريق الأمر` ، ويتم إدخال `sh` ثم النقر على موافق.

يتم إدخال الأمر التالي لتحديث تلقائي:

```shell
acme.sh --upgrade --auto-upgrade
```

ثم يتم إدخال الأمر التالي لتطبيق الشهادة:

```shell
acme.sh --issue --dns dns_dp -d wiki-power.com -d *.wiki-power.com
```

حيث `dns_dp` يمثل Tencent Cloud DNSPod ، وإذا كان Alibaba Cloud ، فيرجى إدخال `dns_ali` ، وإذا كان Cloudflare ، فيرجى إدخال `dns_cf` ، وإذا كان غير ذلك ، فيرجى الرجوع إلى الدليل الرسمي [**dnsapi**](https://github.com/acmesh-official/acme.sh/wiki/dnsapi). بالإضافة إلى ذلك ، يمثل `*.wiki-power.com` شهادة النطاق العام. إذا كنت ترغب في تطبيق عدة نطاقات في نفس الوقت ، فيمكنك القيام بذلك على النحو التالي:

```shell
acme.sh --issue --dns dns_dp -d aaa.com -d *.aaa.com -d bbb.com -d *.bbb.com -d ccc.com -d *.ccc.com
```

## في وضع الخادم الخلفي daemon، سيقوم acme.sh بتحديث الشهادة تلقائيًا كل 60 يومًا بناءً على سجل الطلبات.

### إنشاء شهادة

إذا كان كل شيء على ما يرام، يمكنك العثور على ملفات الشهادة والمفتاح في `docker/acme.sh/اسم المجال المسمى`، ويمكن نسخها إلى المكان الذي تحتاج إليه.

## المراجع والشكر

- [خدمات NAS المتقدمة لـ Synology - تثبيت acme.sh لتلقائي طلب شهادة المجال](https://www.ioiox.com/archives/88.html)

> عنوان النص: <https://wiki-power.com/>  
> يتم حماية هذا المقال بموجب اتفاقية [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh)، يُرجى ذكر المصدر عند إعادة النشر.

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
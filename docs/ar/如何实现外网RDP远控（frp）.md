# كيفية تحقيق التحكم عن بعد في RDP عبر الإنترنت (frp)

استخدام frp للتحكم في سطح المكتب عن بعد في أي شبكة.

## لماذا استخدام RDP

RDP هو بروتوكول مدمج في Windows. بالمقارنة مع برامج سطح المكتب عن بعد المتوفرة في السوق مثل Todesk و Anydesk و Sunflower وغيرها ، فإنه يتمتع بالمزايا التالية:

- توافق أفضل ، يتكيف مع دقة الجهاز ويمكن استخدام لوحة المفاتيح والفأرة
- حرية أكبر ، لا يوجد حد لعدد الأجهزة ولا يوجد نظام عضوية
- سرعة الاتصال تعتمد على سرعة الإنترنت للكمبيوتر وتكوين الخادم

## لماذا استخدام frp

يدعم RDP فقط استخدام نفس مجال IP ، لذلك نحتاج إلى استخدام طريقة frp للتخلص من الشبكة الداخلية للتحكم عن بعد في الإنترنت.

frp هو برنامج بروكسي عكسي ، حجمه خفيف ولكنه قوي الأداء ، يمكنه جعل الأجهزة التي تقع في الشبكة الداخلية أو وراء جدار الحماية تقدم خدمات للعالم الخارجي ، وهو يدعم العديد من البروتوكولات مثل HTTP و TCP و UDP.  
يتم تحقيق التحكم عن بعد في RDP عبر الإنترنت باستخدام frp عن طريق الاتصال بالجهاز المستهدف مع الخادم ، ونحن نتصل بالجهاز المستهدف غير مباشرة من خلال الخادم لتحقيق التحكم عن بعد.

## التحضير

- الخادم (يمكن أن يكون خادم سحابي أو جهاز مادي لديه عنوان IP العام)
- الجهاز المستهدف (يجب أن يكون Windows Professional أو أعلى)
- جهاز التحكم عن بعد (متوافق مع جميع المنصات)

## إعدادات الخادم

أولاً ، تحقق من هيكل الخادم:

```shell
arch
```

استشر صفحة [**Releases**](https://github.com/fatedier/frp/releases) لـ frp واختر الإصدار الذي يتوافق مع هيكل الخادم الخاص بك (على سبيل المثال ، هيكل X86_64 هو amd64):

```shell
wget https://github.com/fatedier/frp/releases/download/v0.36.2/frp_0.36.2_linux_amd64.tar.gz
```

بعد التنزيل ، قم بفك الضغط وتغيير الاسم:

```shell
tar -zxvf frp_0.36.2_linux_amd64.tar.gz && mv frp_0.36.2_linux_amd64 frp
```

لنلقي نظرة على الملفات داخل مجلد frp:

```shell
cd frp && ls
```

- frps
- frps.ini
- frpc
- frpc.ini

`frps` و `frps.ini` هما برنامج الخادم وملف التكوين (ينتهي بـ s للخادم) ، بينما `frpc` و `frpc.ini` يتعلقان بالعميل (ينتهي بـ c للعميل) ، ولكننا لا نحتاج إليهما في الوقت الحالي ، يمكن حذفهما:

```shell
rm -f frpc frpc.ini
```

بعد ذلك ، نقوم بتعديل ملف `frps.ini`:

```shell
vim frps.ini
```

```ini title="frps.ini"
[common]
bind_port = 7000
dashboard_port = 7500
token = 12345678
dashboard_user = admin
dashboard_pwd = admin
```

- **bind_port** : منفذ الاتصال بين العميل والخادم ، وسيتم استخدامه في إعدادات العميل في وقت لاحق ، ويمكن تركه على الإعداد الافتراضي.
- **dashboard_port** : منفذ لوحة القيادة للخادم ، ويمكن تركه على الإعداد الافتراضي. إذا تم تعيينه على الإعداد الافتراضي `7500` ، فيمكن الوصول إلى لوحة القيادة (على سبيل المثال ، `عنوان IP للخادم: 7500`) لعرض حالة frp.
- **token** : كلمة مرور الاتصال بين العميل والخادم ، يرجى تعيينها بنفسك.
- **dashboard_user** / **dashboard_pwd** : اسم المستخدم وكلمة المرور للوحة القيادة ، يرجى تعيينها بنفسك.

بعد الانتهاء من التحرير ، اضغط على `Esc` ثم اكتب `:wq` لحفظ التغييرات والخروج.

لتشغيل خدمة frp في الخلفية ، يمكننا استخدام أمر nohup:

```shell
nohup ./frps -c frps.ini &
```

إذا رأيت الإخراج التالي:

```shell
nohup: ignoring input and appending output to 'nohup.out'
```

فهذا يعني أن الخدمة تعمل بشكل صحيح. يمكننا أيضًا استخدام الأمر `jobs` لعرض الخدمات التي تعمل حاليًا.

للتحقق من نجاح إعداد الخادم ، يمكننا الوصول إلى `x.x.x.x:7500` باستخدام اسم المستخدم وكلمة المرور المكونة أعلاه ، ومعرفة ما إذا كان بإمكاننا الوصول بسلاسة إلى لوحة القيادة. إذا لم يتم الوصول إلى لوحة القيادة ، فقد يتم فتح المنفذ ذات الصلة في جدار الحماية على الخادم.

## تكوين العميل

مرة أخرى ، يرجى الرجوع إلى صفحة [**Releases**](https://github.com/fatedier/frp/releases) في frp ، واختيار الإصدار الذي يتوافق مع البنية التحتية الخاصة بك للتنزيل. بعد التنزيل ، قم بفك الضغط وإعادة التسمية ، ويمكن حذف ملفات `frps` و `frps.ini`. افتح ملف `frpc.ini`:

```ini title="frpc.ini"
[common]
server_addr = x.x.x.x
server_port = 7000
token = 12345678
[rdp]
type = tcp
local_ip = 127.0.0.1
local_port = 3389
remote_port = 7001
[smb]
type = tcp
local_ip = 127.0.0.1
local_port = 445
remote_port = 7002
```

- **server_addr** : عنوان IP للخادم ، يرجى تعديله بنفسك.
- **server_port** : يجب الاحتفاظ بقيمة `bind_port` في الخادم مماثلة ، والتي هي افتراضيًا `7000`.
- **token** : رمز الاتصال ، يجب الاحتفاظ به مماثلًا لتكوين الخادم.

بعد ذلك ، نقوم بتكوين القواعد المخصصة الخاصة بنا:

- **[rdp]** : [xxx] يشير إلى اسم القاعدة ، ويمكن تخصيصه.
- **type** : نوع بروتوكول التوجيه ، يمكن اختيار TCP / UDP
- **local_port** : رقم المنفذ المحلي ، وهنا يتم إدخال منفذ بروتوكول RDP (3389)
- **remote_port** : رقم المنفذ المفتوح على الخادم ، يمكن تخصيصه.

> يتم تعيين رقم المنفذ الافتراضي لبروتوكول RDP (Remote Desktop) على Windows على 3389 ، وهو بروتوكول TCP.
> يتم تعيين رقم المنفذ الافتراضي لبروتوكول SMB (بروتوكول مشاركة الملفات على Windows) على 445 ، وهو بروتوكول TCP.

لتشغيل frpc في الخلفية ، نقوم بإنشاء النص البرمجي `frpc.vbs` ولصق المحتويات التالية فيه:

```vbscript title="frpc.vbs"
set ws=WScript.CreateObject("WScript.Shell")
ws.Run "c:\frp\frpc.exe -c c:\frp\frpc.ini",0
```

يرجى ملاحظة أنه قد يتطلب تعديل المسار.

ضع `frpc.vbs` في الدليل `C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp` ، وسيتم تمكين التشغيل التلقائي عند بدء التشغيل.

إذا كنت ترغب في الاختبار ، فيمكنك تشغيل النص البرمجي مباشرةً ، أو إعادة التشغيل للتشغيل التلقائي.

## تكوين الجهاز البعيد

### الجهاز الضابط هو جهاز محمول

إذا كنت ترغب في التحكم عن بعد في جهاز الكمبيوتر على هاتفك المحمول أو iPad ، فيجب عليك تثبيت تطبيق `Microsoft Remote Desktop` أولاً ، ثم اتبع الخطوات التالية:

1. انقر فوق `+` - `إضافة كمبيوتر` في الزاوية العلوية اليمنى من التطبيق
2. أدخل `IP: remote_port` في `اسم الكمبيوتر` ، على سبيل المثال `x.x.x.x:7001` ، ثم انقر على العودة
3. أدخل اسم مستخدم وكلمة مرور حساب الكمبيوتر الخاص بالجهاز البعيد ، ثم انقر على العودة

إذا كان كل شيء على ما يرام ، فيجب أن تتمكن من التحكم عن بعد بنجاح الآن.

### الجهاز الضابط هو Windows

يمكنك ببساطة البحث عن `Remote Desktop Connection` في قائمة البدء وفتحه ، ثم إدخال `IP: remote_port` مثل `x.x.x.x:7001` ، واتباع التعليمات لإدخال اسم المستخدم وكلمة المرور ، وبذلك يمكنك التحكم عن بعد.

## المراجع والشكر

- [استخدام frp للاتصال بالشبكة الداخلية](https://sspai.com/post/52523)
- [استخدام nohup في Linux](https://ehlxr.me/2017/01/18/Linux-%E7%9A%84-nohup-%E5%91%BD%E4%BB%A4%E7%9A%84%E7%94%A8%E6%B3%95/)
- [دليل إعداد مكتب عن بعد مخصص باستخدام frp](https://pa.ci/77.html)

> عنوان النص: <https://wiki-power.com/>  
> يتم حماية هذا المقال بموجب اتفاقية [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh)، يُرجى ذكر المصدر عند إعادة النشر.

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
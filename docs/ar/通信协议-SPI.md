# البروتوكولات الاتصالية - SPI

SPI (Serial Peripheral Interface) هو بروتوكول اتصال **ثنائي الاتجاه، متزامن، متسلسل، رئيسي / فرعي، حافلة** ، وسرعة نقل البيانات الخاصة به تبلغ 8 ميجابت. يمكن أن يكون لدى SPI مضيف واحد فقط ، ويمكن توصيل جهاز أو أكثر. عند توصيل العديد من الأجهزة ، يتعين استخدام دبابيس تحديد الشريحة (chip select ، CS).

![](https://img.wiki-power.com/d/wiki-media/img/20210911095950.png)

## دبابيس SPI

- **SCLK** (serial clock) : إشارة توقيت موجهة من المضيف ، وهي إشارة مدخل للعينة في الجهة الفرعية. يتم تخزين إشارات SDO و SDI بناءً على إشارة التوقيت على SCLK. يتم نقل بيت واحد خلال فترة توقيت واحدة ، لذلك يتم تحديد سرعة النقل بتردد التوقيت الذي ينتجه المضيف.
- **SDI / SDO** (serial data in / serial data out) : يصف اتجاه تدفق البيانات بالنسبة للمضيف ، ولكن في معظم الأحيان يظهر MOSI (Master Out Slave In) و MISO (Master In Slave Out) على اللوحة. على سبيل المثال ، يكون SDO هو MOSI على المضيف و MISO على الجهاز الفرعي ، بينما يكون SDI هو MISO على المضيف و MOSI على الجهاز الفرعي. في توبولوجيا سلسلة الزهور ، يتصل جهاز A MISO بجهاز B MISO.
- **CS / SS** (chip select / slave select) : يتم توجيهها من المضيف ، وتستخدم لتحديد أولوية الاتصال على حافلة SPI. عندما يكون مستوى CS منخفضًا ، يتم تنشيط الاتصال SPI. يكون CS فعالًا عندما يكون مستوى الجهد منخفضًا.

## عملية تخزين بيانات SPI

- يتم تخزين بيانات SPI عند حافة صعودية أو هبوطية لـ SCLK.
- يُشار إلى الحافة التي تم تخزين البيانات عليها باسم الحافة الحرجة.
- على سبيل المثال ، يُمثل الشكل الأيسر أدناه تخزين SDO عند الحافة الصعودية للمنطق `1` ، بينما يُمثل الشكل الأيمن تخزين SDO عند الحافة الهابطة للمنطق `0`.

![](https://img.wiki-power.com/d/wiki-media/img/20211026151750.png)

## مثال على قراءة SPI

1. الحافة الحرجة هي الحافة الصعودية.
2. يتم إخراج المضيف إلى الجهاز الفرعي (SDI على الجهاز الفرعي).
3. يتم سحب دبوس CS إلى 0 فولت لتنشيط SPI.
4. يتم نقل البيانات بالترتيب من البت الأعلى (MSB) إلى البت الأدنى (LSB) عند حافة صعودية لـ SCLK.
5. تم نقل البيانات بنجاح: `1011001`

![](https://img.wiki-power.com/d/wiki-media/img/20211026152228.png)

## الحافة الحرجة لـ SPI

- $t_{SU}$ (setup time) : يحدد بعد مدة قبل حدوث الحافة الحرجة يجب أن يتم تحديد بيانات SDI وتثبيتها.
- $t_{HO}$ (hold time) : يحدد مدة يجب فيها الاحتفاظ بالبيانات على SDI بعد حدوث الحافة الحرجة.
- $t_{DO}$ (delay time) : يحدد مدة تأخير البيانات الصالحة على SDO بعد حدوث الحافة الحرجة.

![](https://img.wiki-power.com/d/wiki-media/img/20211026160940.png)

## وضع النقل لـ SPI (4 أنواع)

- **CPOL** (clock polarity) : يحدد قطبية التوقيت في حالة الخمول (عدم نقل البيانات) ، حيث يمثل الصفر مستوى الجهد المنخفض ، ويمثل الواحد مستوى الجهد العالي.
- **CPHA** (clock phase) : يحدد متى يتم تخزين البيانات عند الحافة الصعودية أو الهابطة. يمثل الصفر تخزين البيانات عند الحافة الأولى التي تتغير فيها الإشارة ، بينما يمثل الواحد تخزين البيانات عند الحافة الثانية التي تتغير فيها الإشارة.

| رقم الوضع | CPOL (القطبية الساعة) | CPHA (مرحلة الساعة) | حافة الاحتفاظ |
| -------- | ---------------- | ------------------------- | -------- |
| 0        | 0 (مستوى منخفض)      | 0 (الاحتفاظ في الحافة الأولى) | حافة صعودية   |
| 1        | 0 (مستوى منخفض)      | 1 (الاحتفاظ في الحافة الثانية) | حافة هبوطية   |
| 2        | 1 (مستوى عالي)      | 0 (الاحتفاظ في الحافة الأولى) | حافة هبوطية   |
| 3        | 1 (مستوى عالي)      | 1 (الاحتفاظ في الحافة الثانية) | حافة صعودية   |

![](https://img.wiki-power.com/d/wiki-media/img/20211026162028.png)

## سلسلة الزهور (Daisy Chain)

![](https://img.wiki-power.com/d/wiki-media/img/20211026164011.png)

في الوضع العادي ، يحتاج كل جهاز فرعي في SPI إلى خط CS. عندما يكون هناك العديد من الأجهزة الفرعية ، يستخدم المضيف الكثير من مخارج الإدخال / الإخراج. باستخدام توبولوجيا سلسلة الزهور ، يمكن استخدام خط CS واحد فقط لتشغيل جميع الأجهزة الفرعية.

يتم توصيل البيانات في سلسلة الزهور من المضيف إلى الجهاز الفرعي الأول ، ثم من الجهاز الفرعي الأول إلى الجهاز الفرعي الثاني ، وهكذا ، حيث تتدفق البيانات عبر الخطوط المتسلسلة حتى الجهاز الفرعي الأخير ، الذي يرسل البيانات إلى المضيف عبر SDO.

## مزايا وعيوب SPI

المزايا:

- اتصال ثنائي الاتجاه كامل
- تشغيل بواسطة تحريك الإشارة ، مما يوفر تكامل إشارة جيد وسرعة عالية
- بروتوكول مرن ، ليس مقتصرًا على بايت واحد بطول 8 بت
- تصميم الأجهزة بسيط
  - لا يلزم مقاومات سحب عالية ، مما يؤدي إلى استهلاك طاقة أقل
  - لا يوجد آلية تحكيم أو وضع فاشل ذي صلة
  - لا يحتاج الجهاز الفرعي إلى ساعة (توفرها المضيف)
  - لا يحتاج الجهاز الفرعي إلى عنوان منفصل
  - لا يلزم مرسل / مستقبل
  - الإشارات ذات اتجاه واحد ، مما يسهل العزل الكهربائي للتيار
- لا يوجد حد أقصى لسرعة الساعة

العيوب:

- يستخدم مزيد من الأرجل من I2C
- لا يمكن للجهاز الفرعي إجراء استجابة الأجهزة الفرعية بالأجهزة الفرعية
- لا يوجد آلية فحص الأخطاء ، مثل بت التحقق من الزوجية في UART
- يمكن أن يكون هناك مضيف واحد فقط
- المواصفات غير موحدة ، ولا يمكن التحقق من التوافق
- المسافة النسبية للنقل قريبة نسبيًا (بالمقارنة مع CAN و RS232 و RS485 وما إلى ذلك)

## المراجع والشكر

- "Analog Engineer's Pocket Reference"

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
# البروتوكولات الاتصالية - I2C

I2C (Inter-Integrated Circuit) هو حافلة اتصال متسلسلة تسمح بوجود عدة مضيفين، ولكن يمكن أن يكون هناك مضيف واحد فقط متصل في نفس الوقت. يتكون I2C من خطي إشارة مفتوحة، ويتم توصيله بسهولة باستخدام مقاومات السحب العلوية، والجهد النموذجي هو 3.3 فولت أو 5 فولت بالمنطق الإيجابي. تنقسم سرعة النقل إلى وضع السرعة العالية (400 كيلوبت في الثانية) ووضع السرعة القياسية (100 كيلوبت في الثانية) ووضع السرعة المنخفضة (10 كيلوبت في الثانية).

على حافلة I2C ، يتم اختيار العبد بعنوان I2C الخاص به. يمكن استخدام هذا النظام في مضيف واحد للتحكم في عدة عبيد عبر خطين.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211026174634.png)

## دبابيس I2C

- **SCL** (ساعة متسلسلة): موجة مربعة تنتجها المضيف ، وتستخدم للتحكم في سرعة النقل وتخزين البيانات.
- **SDA** (بيانات متسلسلة): هذا هو خط إشارة **نصف ثنائي الاتجاه ومتزامن** ، والبيانات المنقولة تشمل العنوان وإشارة التحكم والبيانات المتصلة.

## عنوان I2C

- تقسيم عنوان I2C هو عنوان بت 7 بالإضافة إلى إشارة القراءة / الكتابة بت 1.
- يجب أن يكون لكل جهاز على حافلة I2C عنوان فريد ، وإذا تكرر العنوان ، فسيحدث خطأ. يمكن برمجة عناوين بعض الأجهزة I2C.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211027112717.png)

## اتصال I2C

- **START**: يقوم المضيف بإطلاقه عندما يكون SCL عاليًا ويخفض SDA.
- **STOP**: يقوم المضيف بإطلاقه عندما يكون SCL عاليًا ويفرج عن SDA (يصبح عاليًا).
- **ACK** (اعتراف): يتم نقل I2C مع كل نبضة SCL ، ويتم نقل 1 بايت (8 بت) في كل مرة. يتم الاحتفاظ بالنبضة التاسعة من كل نقل كإشارة تأكيد من العبد ، وتشير إشارة ACK في كل مرة إلى نجاح النقل السابق.

### مثال على نقل I2C

قيمة هذا النقل هي `11001101`:

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211104172952.png)

1. يخفض المضيف مستوى SDA لإنشاء إشارة START.
2. يتم تعيين البت الأول ، يخفض المضيف SCL ويخرج إشارة الساعة عبر DAC.
3. عند الوصول إلى البت التاسع ، لا يخفض المضيف SDA ، وإذا قام العبد بتأكيد النقل الكامل ، فسيخفض SDA لإعلام المضيف.

### نقل البيانات الفعال

1. يجب أن يظل SDA ثابتًا خلال هذه الفترة عندما يكون SCL عاليًا (نقل البيانات) حتى يكون فعالًا.
2. يسمح فقط بتغيير قيمة SDA بين نبضات SCL عندما يكون SCL منخفضًا.
3. عندما يكون SCL عاليًا ويحدث تغيير في SDA ، يتم تفسيره على أنه حدث START أو RESTART أو STOP.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211105172139.png)

### توقيت الارتفاع / الانخفاض في دائرة الواجهة

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211108093819.png)

كما هو موضح في الشكل ، يتم توصيل الترانزستور عندما يكون المستوى منخفضًا ، ويتم تفريغ السعة $C_b$ إلى المستوى المنخفض. على العكس ، يتم قطع الترانزستور عندما يكون المستوى عاليًا ، وسيقوم المقاوم العلوي بشحن $C_b$ إلى المستوى العالي.

- $t_r$ (زمن الارتفاع): الوقت الأقصى الذي يستغرقه الإشارة للانتقال من المستوى المنخفض إلى المستوى العالي. نظرًا لأن I2C هو إشارة مفتوحة ، فإن زمن الارتفاع يتم تحديده بواسطة ثوابت RC للمقاومة العلوية وسعة الحافلة.
- $t_f$ (زمن الانخفاض): الوقت الأقصى الذي يستغرقه الإشارة للانتقال من المستوى العالي إلى المستوى المنخفض.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211108095142.png)

### حساب مقاومة السحب العلوي لـ I2C



- الحد الأدنى لمقاومة السحب العلوي: $R_{Pull(Min)}=\frac{V_{DD}-V_{OLMAX}}{I_{SinkMax}}$
- الحد الأقصى لمقاومة السحب العلوي: $R_{Pull(Max)}=\frac{t_r}{0.8473*C_b}$

يؤدي الحد الأدنى لمقاومة السحب العلوي إلى أقصر وقت صعود. إذا استخدمت قيمة مقاومة أقل من هذه القيمة، فسيؤدي ذلك إلى استهلاك كمية كبيرة من التيار عندما يتم فتح المفتاح الناتج (مستوى منخفض منطقي)، وهذا يخالف المواصفات القصوى للمستوى الناتج المنخفض المنطقي.

يؤدي الحد الأقصى لمقاومة السحب العلوي إلى أطول وقت صعود. إذا استخدمت مقاومة سحب أعلى من هذه القيمة، فسيؤدي ذلك إلى خرق متطلبات التوقيت.

$V_{DD}$ يمثل جهد التغذية؛ $V_{OLMAX}$ يمثل أقصى مستوى منخفض منطقي (القيمة النموذجية هي 0.4 فولت)؛ $I_{SinkMax}$ يمثل أقصى تيار تصريف (القيمة النموذجية هي 3 مللي أمبير)؛ $C_b$ يمثل سعة الخط الكلية، ويعتمد على طول وعرض مسارات الدائرة المطبوعة وسعة الأجهزة المتصلة بالخط.

مثال حسابي:

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211108103406.png)

## المراجع والشكر

- 《Analog Engineer’s Pocket Reference》
- [I2C 总线该怎么用？看完你就会了](https://mp.weixin.qq.com/s/IeL77NTyVdTdkcNtqjjFPA)
- [[电路]I2C 总线协议 🚧](https://zhenhuizhang.tk/post/dian-lu-i2c-zong-xian-xie-yi/)

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
# RobotCtrl_Func - لوحة توسيع الأجهزة الخارجية

![](https://img.wiki-power.com/d/wiki-media/img/20220527113505.png)

مستودع المشروع: [**linyuxuanlin/RobotCtrl/RobotCtrl_Func**](https://github.com/linyuxuanlin/RobotCtrl/tree/main/RobotCtrl_MultiBoard_Project/RobotCtrl_Func)

معاينة المشروع عبر الإنترنت:

<div class="altium-iframe-viewer">
  <div
    class="altium-ecad-viewer"
    data-project-src="https://github.com/linyuxuanlin/RobotCtrl/raw/main/RobotCtrl_MultiBoard_Project/RobotCtrl_Func_V0.8B.zip"
  ></div>
</div>

ملاحظة: يتم تضمين المشروع في [**RobotCtrl - STM32 通用开发套件**](https://wiki-power.com/ar/RobotCtrl-STM32%E9%80%9A%E7%94%A8%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6).

## تصميم المخطط الأساسي

تتضمن وظائف RobotCtrl_Func الرئيسية ما يلي:

- مدخل طاقة 12 فولت، مدخل / مخرج طاقة 5 فولت، مخرج طاقة 3.3 فولت (مخرج نقطة الاختبار)
- دائرة تحويل الطاقة الثابتة 5 فولت إلى 3.3 فولت \* 2 (لتزويد الحساسات / Ethernet، مخرج نقطة الاختبار)
- دائرة اتصال Ethernet
- دائرة اتصال CAN \* 2
- دائرة اتصال سلسلة (RS-232 ومستوى TTL)
- دائرة الجرس
- زر المستخدم \* 2
- مؤشر LED للمستخدم \* 3
- وحدة استشعار الاتجاه MPU6050
- واجهة مستشعر القياس عن بعد بالأشعة تحت الحمراء \* 4
- واجهة الموجات فوق الصوتية \* 5
- واجهة GPIO للمستخدم \* 6
- موصل B2B (يوفر جميع المداخل / المخارج)
- واجهة تنزيل SW

### الطاقة

يحتوي RobotCtrl_Func على 2 مسارات LDO ، وهي مماثلة لتلك الموجودة في RobotCtrl_Core ، حيث يتم توفير مسار للحساسات الخارجية ومسار آخر لدائرة Ethernet.

### دائرة اتصال Ethernet

يعتمد اتصال Ethernet على رقاقة PHY Ethernet ، ويتم التواصل مع الميكروكنترولر عبر واجهة RMII ، ويتم التواصل مع الشبكة الخارجية عبر كابل RJ45 الذي يحتوي على محول عزل مدمج. يتم استخدام مولد تردد خارجي 25 ميجاهرتز لساعة Ethernet ، ويجب توفير طاقة مستقلة لتقليل التداخل الكهربائي. يتم استخدام نفس حل توفير الطاقة المستقل لدائرة Ethernet الموجودة في اللوحة الأساسية. يمكن الرجوع إلى مبدأ عمل اتصال Ethernet في المقال [**HAL 库开发笔记 - 以太网通信（LwIP）**](https://wiki-power.com/ar/HAL%E5%BA%93%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%80%9A%E4%BF%A1%EF%BC%88LwIP%EF%BC%89).

### دائرة اتصال CAN

يتم بناء دائرة اتصال CAN على رقاقة استقبال / إرسال CAN ، ويتم نقل الإشارات عبر مستوى الجهد المختلف CAN. يتم توصيل متحكم بروتوكول CAN (مثل الميكروكنترولر) بمحول الإرسال / الاستقبال عبر خطوط الاتصال السلسلية (RX / TX) ، ويتم تحويلها إلى إشارات CAN (CANH / CANL) على محول الإرسال / الاستقبال ، ويتم تحديد وضع السرعة العالية / الصامت عبر دبوس RS. يجب إضافة مقاومة 120 أومًا في نهاية الحافلة CAN لتوفير مطابقة الانتهاء وتقليل الانعكاس الإشارة. يمكن الرجوع إلى مبدأ عمل اتصال CAN في المقال [**通信协议 - CAN**](https://wiki-power.com/ar/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE-CAN) و [**HAL 库开发笔记 - 串口通信**](https://wiki-power.com/ar/HAL%E5%BA%93%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-CAN%E9%80%9A%E4%BF%A1).

### دائرة اتصال سلسلة

### دائرة الجرس

### زر المستخدم

### مؤشر LED للمستخدم

### وحدة استشعار الاتجاه MPU6050

### واجهة مستشعر القياس عن بعد بالأشعة تحت الحمراء

### واجهة الموجات فوق الصوتية

### واجهة GPIO للمستخدم

### موصل B2B

### واجهة تنزيل SW

يحتوي RobotCtrl_Func على دائرة اتصال سلكي RS-232 المدمجة، ويتم توفير مخرج USART1/UART5 بمستوى TTL. يمكن الرجوع إلى مبدأ الاتصال السلكي في المقالات [**البروتوكولات الاتصالية - الاتصال السلكي**](https://wiki-power.com/ar/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE-%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1) و [**ملاحظات تطوير مكتبة HAL - الاتصال السلكي**](https://wiki-power.com/ar/HAL%E5%BA%93%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1).

تستخدم دائرة اتصال RS-232 رقاقة تحويل TTL إلى مستوى 232، وتحول TTL الميكروكنترولر إلى مستوى RS-232. ولتحسين أداء EMC، يمكن توصيل دبوس الإسكان الخارجي لمقبس DB9 بتلفزيون ثنائي الاتجاه (TVS) إلى الأرض، ويتطلب تحويل TTL إلى RS-232 إضافة تفريغ الطاقة الخارجية والسعة الذاتية.

### دائرة الجرس

تستخدم دائرة الجرس جرس 12 فولت ويمكن التحكم فيه بواسطة مكبر للإشارة الثلاثي.

### أزرار المستخدم والمؤشرات الضوئية

يمكن الرجوع إلى مبدأ أزرار المستخدم والمؤشرات الضوئية في RobotCtrl_Core، ولا يتم ذكرها هنا.

### وحدة استشعار الاتجاه

يتم استخدام وحدة MPU6050 مباشرةً، ويتم تخصيص واجهة I2C للتواصل مع الميكروكنترولر. يمكن الرجوع إلى مبدأ الاتصال I2C في المقالات [**البروتوكولات الاتصالية - I2C**](https://wiki-power.com/ar/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE-I2C) و [**ملاحظات تطوير مكتبة HAL - الاتصال السلكي (MPU6050)**](https://wiki-power.com/ar/HAL%E5%BA%93%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0-I2C%E9%80%9A%E4%BF%A1%EF%BC%88MPU6050%EF%BC%89).

### واجهة استشعار القياس بالأشعة تحت الحمراء

تستخدم دائرة واجهة استشعار القياس بالأشعة تحت الحمراء أربعة مداخل لاستشعار الأشعة تحت الحمراء بتيار 12 فولت وإشارة (نوع NPN المفتوح دائمًا)، لذلك يتم توفير 12 فولت من RobotCtrl_Power وإضافة أربعة رقائق عزل الضوء لنقل إشارات الجهد العالي والمنخفض. يجب حساب مقاومة التيار المحدود وفقًا لحجم التيار الكهربائي والتأكد من أنها ضمن نطاق الجهد المحدد في دليل البيانات. يمكن الرجوع إلى مبدأ عزل الضوء في المقالات [**العناصر الأساسية - عزل الضوء الكهروضوئي**](https://wiki-power.com/ar/%E5%9F%BA%E6%9C%AC%E5%85%83%E5%99%A8%E4%BB%B6-%E5%85%89%E7%94%B5%E8%80%A6%E5%90%88%E5%99%A8).

### واجهة إدخال الطاقة وموصل B2B

يتم توفير واجهة إدخال الطاقة لوحة التوسع الخارجية بأربعة دبابيس للاتصال بلوحة إمداد الطاقة في الأسفل. يتم استخدام موصل B2B لتوفير الطاقة والاتصالات البيانية للوحة التحكم الرئيسية.

## اختبار الأجهزة

### اختبار الطاقة

إدخال الطاقة (يجب اتباع هذه الخطوات لجميع مشاريع الاختبار):

- VCC_12V: عبر P1.
- VCC_5V: عبر P2 أو J1_1/2.
- GND: عبر P3 و P4 و J1_31/32 أو J2_30/31 مع الأرض الخارجية.

ثابت الجهد 5 فولت إلى 3.3 فولت (للحساسات):

- VCC_3V3S: قياس جهد C30 عبر نهايتيه.

ثابت الجهد 5 فولت إلى 3.3 فولت (لشبكة الإيثرنت):

- VCC_3V3E: قياس جهد C26 عبر نهايتيه.

### اختبار الحساسات المدمجة في اللوحة

أزرار المستخدم:

- تكوين PE2/PE3 كنمط إدخال GPIO مع مقاومة السحب العالية، وقراءة الإشارة الكهربائية المنخفضة عند الضغط على الزر، والإشارة الكهربائية العالية عند الإفراج عنه.

المؤشرات الضوئية للمستخدم:

- تكوين PC6/PC7/PC8 كنمط إخراج GPIO، وإخراج إشارة كهربائية عالية، وتشغيل المؤشرات الضوئية بالترتيب؛ وإخراج إشارة كهربائية منخفضة لإطفاء المؤشرات الضوئية.

وحدة استشعار الاتجاه MPU6050:

- قياس ما إذا كانت نهاية M1 للوحدة 1 متصلة بالأرض بجهد VCC_3V3S.
- اختبار توصيل الدبوس.

الجرس:

- قياس ما إذا كانت القطبية الإيجابية لـ BUZZER1 متصلة بالأرض بجهد VCC_12V.
- تكوين PC9 كنمط إخراج GPIO، وإخراج إشارة كهربائية عالية، وإصدار صوت من الجرس؛ وإخراج إشارة كهربائية منخفضة لإيقاف إصدار الصوت.

تحويل السلكي إلى RS232:

- قياس جهد C3 عبر نهايتيه.
- تشغيل برنامج الاختبار والاختبار عبر دبوس PB10/PB11.

# CAN Bus Communication:

- قياس ما إذا كانت نهايتا C10 / C13 هما جهد VCC_5V.
- تشغيل برنامج الاختبار (اختبار الحلقة الراجعة) ، واختباره من خلال دبوس PD0 / PD1 و PB12 / PB13.

# Ethernet Communication:

- قياس ما إذا كان IC2_9 إلى الأرض هو جهد VCC_3V3S.
- قياس ما إذا كانت VDD1A / VDD2A إلى الأرض هي جهد VCC_3V3E.
- تشغيل برنامج الاختبار واختبار اتصال Ethernet عبر واجهة RMII.

# اختبار الواجهة

واجهة مستشعر القياس عن بعد بالأشعة تحت الحمراء:

- قياس ما إذا كان الدبوس الأول لمقبس J16 / J17 / J18 / J19 إلى الأرض هو جهد VCC_12V.
- تكوين PF2 / PF3 / PF4 / PF5 كإدخال GPIO مسحوب لأسفل ، وجعل IR1 / IR2 / IR3 / IR4 عالية بشكل خارجي (VCC_12V) على التوالي ، ثم يقرأ PF2 / PF3 / PF4 / PF5 إشارة عالية ؛ والعكس صحيح.

واجهة الموجات فوق الصوتية:

- قياس ما إذا كان الدبوس الرابع لمقبس J3 / J4 / J5 / J6 / J7 إلى الأرض هو جهد VCC_3V3S.
- اختبار توصيل دبوس IO.

واجهة GPIO للمستخدم:

- قياس ما إذا كان الدبوس الرابع لمقبس J9 / J10 / J11 إلى الأرض هو جهد VCC_3V3S.
- اختبار توصيل دبوس IO.

> تمت ترجمة هذه المشاركة باستخدام ChatGPT، يرجى [**تزويدنا بتعليقاتكم**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) إذا كانت هناك أي حذف أو إهمال.
# Communication Protocol - I2C

I2C (Inter-Integrated Circuit) is a serial communication bus that allows for multiple masters, but only one master can be online at a time. I2C consists of two open-drain signal lines, with simple wiring and pull-up resistors, with typical logic levels of 3.3V or 5V. The transmission rate is divided into fast mode (400Kb/s), standard mode (100Kb/s), and low-speed mode (10Kb/s).

On the I2C bus, the slave is selected by its I2C address. This can be used to control multiple slaves with two lines on one master.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211026174634.png)

## I2C Pins

- **SCL** (serial clock): A square wave generated by the master, used to control the transmission rate and data latching.
- **SDA** (serial data): This is a **half-duplex, synchronous** signal line, transmitting data including address, control signals, and communication data.

## I2C Address

- I2C address division is a 7-bit address plus a 1-bit read/write indicator.
- Each device on the I2C bus must have a unique address, and problems will occur if the addresses are duplicated. Some devices' I2C addresses can be programmed.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211027112717.png)

## I2C Communication

- **START**: The master initiates by pulling SDA low when SCL is high.
- **STOP**: The master initiates by releasing SDA (raising it to high) when SCL is high.
- **ACK** (acknowledge): I2C transmission is synchronized with each SCL pulse, transmitting one byte (8 bits) each time. The 9th pulse of each transmission is reserved for the slave's confirmation signal, and each ACK signal indicates the success of the previous transmission.

### Example of I2C Transmission Segment

This segment transmits the value `11001101`:

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211104172952.png)

1. The master pulls SDA low to generate the START signal.
2. The first bit is set, and the master pulls SCL low to output the clock signal through the DAC.
3. When the ninth bit is transmitted, the master does not pull SDA low. If the slave confirms the transmission is complete, it will pull SDA low to let the master know.

### Effective Data Transmission

1. When SCL is held high (transmitting data), SDA must remain stable during this time to be effective.
2. SDA can only switch values during the low level between SCL beats.
3. When SCL is high and SDA changes, it will be interpreted as a START, RESTART, or STOP event.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211105172139.png)

### Interface Circuit Rise/Fall Timing

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211108093819.png)

As shown in the figure, the transistor will conduct during the low level and discharge the $C_b$ capacitor to the low level. Conversely, the transistor will be cut off during the high level, and the pull-up resistor will charge $C_b$ to the high level.

- $t_r$ (rise time): The maximum time for the signal to transition from low to high. Because I2C is an open-drain signal, the rise time is determined by the RC time constant of the pull-up resistor and the bus capacitance.
- $t_f$ (fall time): The maximum time for the signal to transition from high to low.

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211108095142.png)

### I2C Pull-Up Resistor Calculation

- Minimum value of pull-up resistor: $R_{Pull(Min)}=\frac{V_{DD}-V_{OLMAX}}{I_{SinkMax}}$
- Maximum value of pull-up resistor: $R_{Pull(Max)}=\frac{t_r}{0.8473*C_b}$

Among them, the minimum value of pull-up resistor will bring the shortest rise time. If the resistance value used is smaller than this, it will cause too much current consumption when the output transistor is turned on (logic low level), violating the maximum logic low level output specification.

The maximum value of pull-up resistor will bring the longest rise time. If a pull-up resistor larger than this value is used, it will violate the timing requirements.

$V_{DD}$ represents the supply voltage; $V_{OLMAX}$ represents the maximum logic low level (typical value is 0.4V); $I_{SinkMax}$ represents the maximum sinking current (typical value is 3mA); $C_b$ represents the bus capacitance, which depends on the length and width of the PCB wiring and the capacitance of the devices connected to the bus.

Calculation example:

![](https://wiki-media-1253965369.cos.ap-guangzhou.myqcloud.com/img/20211108103406.png)

## Reference and Acknowledgement

- "Analog Engineer's Pocket Reference"
- [How to use I2C bus? You will know after reading it](https://mp.weixin.qq.com/s/IeL77NTyVdTdkcNtqjjFPA)
- [[Circuit] I2C bus protocol ðŸš§](https://zhenhuizhang.tk/post/dian-lu-i2c-zong-xian-xie-yi/)

> This post is translated using ChatGPT, please [**feedback**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) if any omissions.

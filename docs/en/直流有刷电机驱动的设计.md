# Design of DC Brushed Motor Drive with H-Bridge

Usually, we use PWM to control the H-bridge circuit to achieve control of the direction and speed of the DC brushed motor, and the PWM duty cycle is proportional to the motor speed.

## Basic knowledge of H-bridge

H-bridge is a bridge circuit that can quickly switch the voltage polarity on the load. This circuit is usually used to drive DC brushed motors to rotate clockwise or counterclockwise. Because its structure looks like the letter "H", it is called an H-bridge circuit.

An H-bridge consists of four switches. S1 and S3 form the high-side switch of the H-bridge, usually P-type MOSFET or PNP-type transistor, and S2 and S4 form the low-side switch of the H-bridge, usually N-type MOSFET or NPN-type transistor.

![](https://img.wiki-power.com/d/wiki-media/img/20210812093751.png)

- When switches S1 and S4 are closed and S2 and S3 are open, the motor rotates normally, referred to as the forward direction.
- When switches S2 and S3 are closed and S1 and S4 are open, the motor rotates in reverse, referred to as the reverse direction.
- When switches S1 and S2 are closed, or S3 and S4 are closed, the power supply is short-circuited, which poses a risk of burning the power supply. This situation is called shoot-through.
- When switches S1 and S3 are closed and S2 and S4 are open, or switches S2 and S4 are closed and S1 and S3 are open, the motor does not rotate. At this time, the motor is in a "brake" state, and the counter-electromotive force generated by the inertia of the motor rotation will be short-circuited, forming a "brake" effect.
- When all four switches S1, S2, S3, and S4 are open, the motor is in a coasting state and will rotate for a long time due to inertia.

In practical circuits, we can use a driver chip to precisely control the four MOS tubes of the H-bridge.

## Choosing discrete components or integrated chips

Compared with using integrated driver chips, building circuits with discrete components has lower cost and greater customizability. Generally, when driving a motor, PWM signals are first output from the MCU, then through optocouplers and logic circuits, and then to the driver chip, and finally to the full-bridge/half-bridge MOS tubes.

However, when building a motor drive with discrete components, there are more things to consider, such as dead zone control (to prevent shoot-through), controlling the appropriate driving voltage, designing protection circuits, etc. The complexity of circuit design is higher, the PCB footprint is larger, the cost is higher, and the design risk is also higher.

Generally, when driving a DC brushed motor, we use an integrated H-bridge driver chip to control the DC brushed motor.

## Selection of MOS tubes

In motor drive, we generally use enhancement-type N-MOS tubes. The reasons are as follows:

1. Use enhancement-type: it can be completely turned off at low level, and can be completely turned on when the level is higher than the turn-on voltage $U_{GS(TH)}$;
2. Use N-MOS: because there are fewer P-MOS models to choose from, the price is higher, the on-resistance is larger, which leads to high heat generation and low efficiency;
3. Use MOS tubes: compared with BJT, MOS tubes have smaller power loss, smaller volume, larger driving current, faster response, and smaller on-resistance.

In actual design, in order to simplify the material merging, we generally use all N-MOS. However, because N-MOS cannot be directly used for high-end control of the H-bridge (because the conduction condition of N-MOS is $V_g-V_s>V_{gs(th)}$), a high-end floating pressure bootstrap circuit (because of its simple structure) needs to be designed to drive the upper tube. For a detailed introduction to bootstrap circuits, please refer to the article [**Power Supply Design - Bootstrap Circuit**](https://wiki-power.com/en/%E7%94%B5%E6%BA%90%E8%AE%BE%E8%AE%A1-%E8%87%AA%E4%B8%BE%E7%94%B5%E8%B7%AF).

Parameters to be noted when selecting N-MOS:

- $V_{DSS}$
- $R_{DS(on)}$

## Integrated H-bridge driver chip

The H-bridge driver chip generally integrates the following protection circuits:

- Over-Voltage Protection (OVP)
- Under-Voltage Lock-Out (UVLO)
- Over-Current Protection (OCP)
- Thermal Shut-Down (TSD)
- Shoot-Through Protection (STP)
- ElectroStatic Discharge (ESD)

Generally, we use gate driver chips to provide power to the gate of high/low-side power N-MOSFETs (according to the data sheet, it must be higher than the $U_{GS(TH)}$ of the MOSFET so that it can conduct between drain D and source S). For example, the following is the parameter of the DRV8701 gate driver:

![](https://img.wiki-power.com/d/wiki-media/img/20210811095012.png)

When used with IRFH8330, it can drive this MOSFET:

![](https://img.wiki-power.com/d/wiki-media/img/20210811095429.png)

## Selection of PWM Frequency

When using PWM signals to control motor speed, attention should be paid to its frequency. If the frequency is too low, the motor will generate noise at low speeds, and the response to changes in duty cycle will also be slow. If the PWM frequency is too high, it will cause large switching losses on the MOSFETs of the H-bridge.

If the specification sheet of the H-bridge driver chip does not give a specific frequency range, generally, PWM signals of around 4kHz-200kHz can ideally control the motor speed.

## Dead-Time Insertion and Cross-Conduction (Direct) Protection

Dead-time can be simply understood as a delay, which makes the upper bridge that conducts during forward rotation completely shut off before opening the lower bridge that needs to be opened during reverse rotation. Too small dead-time can be dangerous, while too large dead-time can cause poor motor response and low utilization efficiency of the power supply.

![](https://img.wiki-power.com/d/wiki-media/img/20210815112048.jpg)

Using an integrated solution: incorporating automatic handshake to use the optimal dead-time, regardless of the commutation rate, voltage, MOS characteristics, and temperature. The handshake is a multi-step process that ensures the use of the optimal dead-time and no cross-conduction. The process of the handshake is as follows:

1. Receive the signal to disable the high-side MOS and monitor $V_{GS}$ to determine when to disable it.
2. Insert dead-time and enable the low-side MOS.

## Decay Mode of H-Bridge

Decay mode refers to which freewheeling path to take to stop the motor. Because DC motors are inductive loads (the current of the inductance cannot change abruptly), to stop the motor, in addition to disconnecting the power supply, a freewheeling path needs to be formed to release the energy on the motor, otherwise the freewheeling current generated by the motor may damage the MOSFETs.

### Asynchronous and Synchronous Decay

We can use a diode to construct a freewheeling path, as shown in the figure:

![](https://img.wiki-power.com/d/wiki-media/img/20211222162216.png)

And we know that the MOSFET itself has a body diode that can act as a freewheeling path. In some applications, a parallel Schottky diode may also be added, so it can be used to implement decay. The mode of decay using a diode is called asynchronous decay. However, the loss of asynchronous decay is relatively large ($2*I*V_D$), so we introduce another decay method, called synchronous decay. Synchronous decay is achieved by opening the MOSFET to achieve freewheeling. Because the conduction resistance $R_{ds(on)}$ of the MOSFET is small, the loss of synchronous decay is relatively small ($I^2*R_{ds(on)*2}$), and the following mainly explains synchronous decay.

![](https://img.wiki-power.com/d/wiki-media/img/20211222172558.png)

### Key Parameters

![](https://img.wiki-power.com/d/wiki-media/img/20211222172913.png)

- $I_{TRIP}$: The current set by the current driver chip, controlled by the driving algorithm;
- $T_{DRIVE}$: Driving stage time
- $T_{BLANK}$: Dead time stage time, to prevent shoot-through
- $T_{OFF}$: Freewheeling stage

### Three modes of synchronous decay

There are three modes of synchronous decay: fast decay, slow decay, and mixed decay. Here, fast and slow refer to the relative speed of current decay during the freewheeling period, not the motor speed.

The differences between the three modes are:

|                             | Fast Decay                               | Slow Decay                           | Mixed Decay                                   |
| --------------------------- | ---------------------------------------- | ------------------------------------ | --------------------------------------------- |
| Phase current ripple        | Large                                    | Small                                | Moderate                                      |
| Freewheeling time $T_{OFF}$ | Short (may lead to larger switch losses) | Long (may hear low frequency noise)  | Moderate (frequency and performance balanced) |
| Phase current drop speed    | Fast                                     | Slow                                 | Moderate                                      |
| Applicable range            | Suitable for large inductance motors     | Suitable for small inductance motors | Moderate                                      |

#### Fast Decay

![](https://img.wiki-power.com/d/wiki-media/img/20211223154627.png)

The process of fast decay is to close the two MOS tubes of the driver, wait for the dead time to pass, and then open the two diagonally opposite MOS tubes to quickly consume the current. During the dead time, the H-bridge will still experience asynchronous decay, but the time is short and can be ignored.

#### Slow Decay

![](https://img.wiki-power.com/d/wiki-media/img/20211223160616.png)

The process of slow decay is to close the two MOS tubes of the driver, wait for the dead time to pass, and then open the two lower tubes to slowly consume the current. Similarly, during the dead time, the H-bridge will still experience asynchronous decay, but the time is short and can be ignored.

#### Mixed Decay

The process of mixed decay is to close the two MOS tubes of the driver, wait for the dead time to pass, and then open the two diagonally opposite MOS tubes (fast decay) to quickly consume the current; then open the two lower tubes (slow decay) to slowly consume the current. The ripple of the phase current in mixed decay mode is between fast decay and slow decay.

## EMC problems and solutions for motor drive

Because DC motors are inductive loads (inductive current cannot change suddenly), in order to prevent unstable rebound or spikes in motor voltage when the H-bridge output is turned off, a large capacitor (>100μF, usually an aluminum electrolytic capacitor) can be placed on the motor voltage source to absorb the flywheel current generated during DC motor braking and stabilize the motor voltage source when the motor switches direction.

Another problem is that the parasitic inductance (inductance + resistance) between the motor voltage source and the motor drive board power line and the parasitic capacitance of the PCB form an LC resonance slot. When the motor voltage source is sent to the motor drive board, if the local bypass capacitance is insufficient, the motor voltage may quickly drop, and the parasitic LC will be triggered, causing oscillation spikes. In order to reduce the spikes caused by the LC resonance of the power line, a 0.1μF bypass capacitor (usually a ceramic capacitor) can be placed near the power pin of the motor H-bridge driver chip.

A reference example:

![](https://img.wiki-power.com/d/wiki-media/img/20211222150738.png)

In addition, a magnetic ring can be added to the motor line to reduce common mode interference (tested and proven).

## References and Acknowledgments

- [A Full-Bridge Driver Circuit Composed of 4 N-MOS](https://www.fanyedu.com/content/90.html)
- [Detailed Explanation of Brushed Motor Design in ROBOCON Competition](https://zhuanlan.zhihu.com/p/27547384)
- [A Brief Discussion on the Drive Circuit of DC Brushed Motors](https://haipeng.me/2021/02/28/h-bridge-driver/)
- [Slow, Mixed and Fast Decay Modes. Why Do We Need To Complicate Things?](https://ebldc.com/?p=86)
- [Mastering Current Recirculation, Decay Modes, and Braking in Motor Drive](https://www.ti.com.cn/cn/lit/an/zhcaa31/zhcaa31.pdf)
- [Current Recirculation and Decay Modes](https://www.ti.com/lit/an/slva321a/slva321a.pdf)

> Original: <https://wiki-power.com/>  
> This post is protected by [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.en) agreement, should be reproduced with attribution.

> This post is translated using ChatGPT, please [**feedback**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) if any omissions.

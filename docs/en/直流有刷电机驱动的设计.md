# Designing a DC Brushed Motor Drive

Typically, we use PWM to control an H-bridge circuit to achieve control over the direction and speed of a DC brushed motor, with the PWM duty cycle being proportional to the motor's speed.

## Basics of an H-Bridge

An H-bridge is a bridge circuit that allows rapid switching of voltage polarity on the load. This type of circuit is commonly used to drive DC brushed motors, enabling them to rotate clockwise or counterclockwise. Due to its shape resembling the letter "H," it is known as an H-bridge circuit.

An H-bridge consists of four switches, where S1 and S3 form the high-side switches using P-type MOSFETs or PNP transistors, while S2 and S4 form the low-side switches using N-type MOSFETs or NPN transistors.

![H-Bridge Diagram](https://img.wiki-power.com/d/wiki-media/img/20210812093751.png)

- When switches S1 and S4 are closed, and S2 and S3 are open, the motor rotates in the forward direction.
- When switches S2 and S3 are closed, and S1 and S4 are open, the motor rotates in the reverse direction.
- Closing both S1 and S2, or S3 and S4, causes a short circuit that poses a risk of damaging the power source; such a condition is known as "shoot-through."
- When either S1 and S3 are closed, and S2 and S4 are open, or S2 and S4 are closed, and S1 and S3 are open, the motor doesn't rotate. In this state, the motor is in a "braking" state, where the counter-electromotive force generated by the motor's inertia is short-circuited, creating a braking effect.
- When all four switches (S1, S2, S3, S4) are open, the motor is in a coasting state and continues to rotate due to its inertia.

In practical circuits, we can use driver chips to precisely control the four MOSFETs in the H-bridge.

## Choosing Discrete Components vs. Integrated Chips

Compared to using integrated driver chips, building the circuit with discrete components offers lower costs and greater customizability. Typically, when driving a motor, a PWM signal is output from an MCU, passes through optocouplers and logic circuits, and then goes to the driver chip, and finally to the full bridge/half bridge MOSFETs.

However, when building a motor drive using discrete components, there are more factors to consider, such as dead-time control (to prevent shoot-through), selecting appropriate drive voltages, and designing protection circuits. This results in higher circuit complexity, increased PCB footprint, higher costs, and elevated design risks.

Usually, when driving a DC brushed motor, integrated H-bridge driver chips are employed to simplify the control.

## Selection of MOSFETs

In motor drives, enhanced N-channel MOSFETs are typically chosen for the following reasons:

1. Enhanced type: These can completely turn off at low levels and fully conduct when the voltage exceeds the threshold voltage $U_{GS(TH)}$.
2. N-channel: P-channel MOSFETs have limited options, higher prices, higher on-resistance, leading to greater heat generation and lower efficiency.
3. MOSFETs: Compared to BJTs, MOSFETs offer lower power losses, smaller size, higher current-driving capabilities, faster response, and lower on-resistance.

In practical design, N-channel MOSFETs are usually used exclusively. However, they cannot be directly employed for high-side H-bridge control (as N-MOSFETs require $V_g-V_s > V_{gs(th)}$ for conduction), so a high-side bootstrap circuit (due to its simplicity) is designed to drive the upper switch. Detailed information on the bootstrap circuit can be found in the article [**Power Supply Design - Bootstrap Circuit**](https://wiki-power.com/%E7%94%B5%E6%BA%90%E8%AE%BE%E8%AE%A1-%E8%87%AA%E4%B8%BE%E7%94%B5%E8%B7%AF).

Key parameters for N-channel MOSFET selection include:

- $V_{DSS}$
- $R_{DS(on)}$

## Integrated H-Bridge Driver Chips

Integrated H-bridge driver chips typically include the following protection circuits:

- Over-Voltage Protection (OVP)
- Under-Voltage Lock-Out (UVLO)
- Over-Current Protection (OCP)
- Thermal Shut-Down (TSD)
- Shoot-Through Protection (STP)
- ElectroStatic Discharge (ESD) Protection

Usually, we use a gate driver chip to provide the gate voltage for the power N-MOSFET on the high voltage/low voltage side. According to the datasheet, it must be higher than the MOSFET's $U_{GS(TH)}$ for the conduction to occur between the drain D and source S. For instance, the following image displays the parameters of the DRV8701 gate driver:

![DRV8701 Gate Driver](https://img.wiki-power.com/d/wiki-media/img/20210811095012.png)

When used in conjunction with the IRFH8330, it can effectively drive this MOSFET:

![IRFH8330 with DRV8701](https://img.wiki-power.com/d/wiki-media/img/20210811095429.png)

## Selecting PWM Frequency

When controlling motor speed using a PWM signal, it's essential to consider its frequency. If the frequency is too low, the motor may produce noise at low speeds, and changes in the duty cycle will have a sluggish response. On the other hand, a high PWM frequency can lead to significant switching losses on the MOSFETs of the H-bridge.

If the datasheet for the H-bridge driver chip doesn't specify a frequency range, typically PWM signals around 4kHz-200kHz can ideally control the motor's speed.

## Dead Time Insertion and Cross-Conduction (Shoot-Through) Protection

Dead time can be understood as a delay that ensures that the upper bridge is completely turned off before the lower bridge is turned on during a forward rotation and vice versa during a reverse rotation. Too little dead time can be dangerous, while too much can result in poor motor response and lower power efficiency.

Using an integrated solution, it's possible to incorporate automatic handshaking to utilize the optimal dead time without being affected by commutation speed, voltage, MOSFET characteristics, or temperature. The handshaking process involves:

1. Receiving a signal to transition from the high-side MOSFET to the low-voltage side MOSFET.
2. Disabling the high-side MOSFET and monitoring $V_{GS}$ to determine when to disable it.
3. Inserting dead time and enabling the low-voltage side MOSFET.

## H-Bridge Decay Modes

Decay mode refers to which freewheeling path is used to bring the motor to a stop. Since a DC motor is an inductive load (inductive current cannot change abruptly), to stop the motor, a freewheeling path is needed in addition to cutting power to dissipate the motor's energy, preventing the risk of damaging the MOSFETs.

### Asynchronous and Synchronous Decay

A freewheeling path can be constructed using diodes, as shown in the diagram:

![Freewheeling Path with Diodes](https://img.wiki-power.com/d/wiki-media/img/20211222162216.png)

MOSFETs have an intrinsic body diode that can serve as a freewheeling path, and in some applications, a Schottky diode may be added in parallel, allowing for synchronous decay. However, asynchronous decay has relatively higher losses ($2*I*V_D$), so we introduce another method called synchronous decay, which is achieved by turning on the MOSFET. Due to the low on-resistance $R_{ds(on)}$ of the MOSFET, synchronous decay has lower losses ($I^2*R_{ds(on)}*2$), and the following section will mainly focus on synchronous decay.

![Synchronous Decay](https://img.wiki-power.com/d/wiki-media/img/20211222172558.png)

### Key Parameters

![Key Parameters](https://img.wiki-power.com/d/wiki-media/img/20211222172913.png)

- $I_{TRIP}$: The current set by the driver chip, controlled by the driving algorithm.
- $T_{DRIVE}$: Drive stage time.
- $T_{BLANK}$: Dead time to prevent shoot-through.
- $T_{OFF}$: Freewheeling period.

### Three Modes of Synchronous Decay

Synchronous decay has three modes: Fast Decay, Slow Decay, and Mixed Decay. Here, fast and slow refer to the relative speed of current decay during the freewheeling period, not the motor's rotational speed.

The differences between the three modes are:

|                        | Fast Decay                    | Slow Decay                  | Mixed Decay                |
| ---------------------- | ---------------------------- | ------------------------ | ---------------------- |
| Phase Current Ripple    | Large                         | Small                         | Moderate                   |
| Off-time $T_{OFF}$ for Recirculation Stage | Short (may lead to higher switching losses) | Long (may result in low-frequency noise) | Moderate (balanced in terms of frequency and performance) |
| Phase Current Decay Rate | Fast                        | Slow                            | Moderate                  |
| Application Range       | Suitable for large inductance motors | Suitable for small inductance motors | Moderate                   |

#### Fast Decay

![](https://img.wiki-power.com/d/wiki-media/img/20211223154627.png)

The process of fast decay involves closing both MOSFETs in the driver, waiting for the dead-time to pass, and then opening the symmetrically paired MOSFETs to rapidly deplete the current. During the dead-time, the H-bridge still undergoes asynchronous decay, but the duration is short and can be ignored.

#### Slow Decay

![](https://img.wiki-power.com/d/wiki-media/img/20211223160616.png)

The process of slow decay involves closing both MOSFETs in the driver, waiting for the dead-time to pass, and then opening the lower MOSFETs to gradually deplete the current. Similarly, during the dead-time, the H-bridge still undergoes asynchronous decay, but the duration is short and can be ignored.

#### Mixed Decay

The process of mixed decay involves closing both MOSFETs in the driver, waiting for the dead-time to pass, and then opening the symmetrically paired MOSFETs (fast decay) to rapidly deplete the current. Then, the lower MOSFETs are opened (slow decay) to gradually deplete the current. In mixed decay mode, the phase current ripple falls between fast and slow decay.

## EMC Issues and Solutions in Motor Driving

Since DC motors are inductive loads (inductive currents cannot change abruptly), to prevent unstable rebound or voltage spikes when the H-bridge switches off the motor's output, a large capacitor (>100μF, typically aluminum electrolytic capacitor) can be placed on the motor voltage source. This capacitor is used to absorb the flywheel current generated during motor braking and stabilize the motor voltage source during motor direction reversal.

Another issue is the parasitic impedance (inductance + resistance) between the motor voltage source and the motor driver board's power lines, along with the parasitic capacitance of the PCB, forming an LC resonance circuit. When the motor voltage source supplies power to the motor driver board, inadequate local bypass capacitance may lead to a rapid voltage drop and trigger parasitic LC oscillations. To reduce spikes caused by power line LC resonance, a 0.1μF bypass capacitor (typically ceramic capacitor) can be placed near the power pins of the motor H-bridge driver chip.

Here's a reference example:

![](https://img.wiki-power.com/d/wiki-media/img/20211222150738.png)

Additionally, adding ferrite beads to the motor wires can reduce common-mode interference (observed to be effective).

## References and Acknowledgments

- [A Full Bridge Drive Circuit Comprising 4 N-MOS Transistors](https://www.fanyedu.com/content/90.html)
- [In-Depth Discussion on the Design of Brushed Motors with ROBOCON Competition](https://zhuanlan.zhihu.com/p/27547384)
- [A Brief Overview of the Drive Circuits for DC Brushed Motors](https://haipeng.me/2021/02/28/h-bridge-driver/)
- [Understanding Slow, Mixed, and Fast Decay Modes: Why Do We Need to Make Things Complex?](https://ebldc.com/?p=86)
- [Mastering Current Recirculation, Decay Modes, and Braking in Motor Drives](https://www.ti.com.cn/cn/lit/an/zhcaa31/zhcaa31.pdf)
- [Exploring Current Recirculation and Decay Modes](https://www.ti.com/lit/an/slva321a/slva321a.pdf)

> Original: <https://wiki-power.com/>
> This post is protected by [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.en) agreement, should be reproduced with attribution.

> This post is translated using ChatGPT, please [**feedback**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) if any omissions.
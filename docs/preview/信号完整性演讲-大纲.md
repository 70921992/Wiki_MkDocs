# Hello

欢迎大家今天来听我的分享。我今天分享的主题是信号完整性，我会讲一些基本概念，和几种常见的信号完整性问题。广义的信号完整性，其实涵盖了信号和电源完整性，还有电磁兼容性 EMC，我们今天只简单介绍狭义的信号完整性问题。我掌握的知识还不是很深，如果有讲得不好的地方也请大家帮忙指出来。

# END

信号完整性的问题更多出现在 PCB 设计中，在 ATE 调试中比较少遇到，但如果遇到了类似的问题，可以为我们提供多一种解决问题的思路。

[nderstanding Signal Integrity](https://www.youtube.com/watch?v=anX8QZMhVjI&list=PLxaBD9eBZcGTZaMZ-3HN5zXFQ06FDOjzJ&index=10&t=1s)

# About signals

我们知道，信号完整性指的是信号在传输线上的质量。我们通常用 0 和 1 表示信号，就是像图上画的，电压比这条线高就定义为逻辑 1，比这条线低就定义为逻辑 0。但信号本身是个模拟量，真实世界的数字电平 0 和 1 并不是理想的。

然后，信号传输的链条通常包括三部分：驱动器？，信号互连和接收器？

# Requirements for good data transmission

大多数情况下，信号是方波的形式，这些方波实际上是由多个频率分量的正弦波组成的。叠加的谐波次数越多，方波就会越方。

所以，好的数字数据传输通常需要保证两个因素，一是构成方波的所有频率分量都应经历相同的幅度变化，就是说应该被放大或衰减相同的倍数。二是所有频率分量的相位应该保持一致。

如果保证不了，就有可能会出现信号失真。

# Signal integrity

因此，信号完整性良好的表现，可以表示为传输线上的信号能按预期、不多不少地达到预设值。也可以说能够在接收器上准确地重建波形。

所有传输系统都会带来不一样的损耗？

在低速电路中，信号完整性问题并不明显，因为互连线对于电信号来说是通畅透明的；但如果往高速走，信号变化的速率变快，上升时间短，数字电平的电压或电流波形就会开始出现畸变，从而导致接收的信息与发出的信息差别太大，出现错误。所以，在高速电路中需要考虑到信号完整性的问题。

对高速信号我们没有严格的定义，一般来说，上升周期小于 1 纳秒的信号可以称为高速信号。

由此可见，信号完整性在高速电路设计中很重要。

# Channel

在理想互连中，信号在从发射器传输到接收器时可能会衰减或放大，也可能会有延迟，但接收信号仍然具有与发射信号基本相同的形状。

但在实际互连中，信号分量频率的相关变化会导致接收信号形状发生变化，这会使接收器更难正确检测传输信号电平或确定其状态。通常来说，高频率分量的信号会比低频率的衰减越多。

信号互连的另一种说法叫传输线，它是一种理想元件，由任意两条一定长度的导线组成，分别称为 **信号路径** 和 **返回路径（参考路径）**（图）观察信号的传输，需要同时看信号路径与返回路径。那怎么去分辨它们呢？一般来说，如果是微带线，会指定平面为返回路径便于分析；但如果两根线是一模一样的（比如双绞线），那就没有严格的区分。在信号完整性的范畴里，我们要尽量接地的概念，而是说返回路径，因为实际情况比接地要复杂。我们来看看实际情况。

我们一般用信号和返回路径之间的电压差表示信号，大家可能会觉得，信号传输的方式，是从信号路径出去，走到头再从返回路径回来，但实际上当信号刚开始进入信号路径时，在返回路径上就已经开始检测到电流了。但实际上信号是这样传输的 ：（gif）

信号互连大致分为 PCB 走线，连接器，或者外部线缆这三种形式。信号完整性的原理在所有的形式上都是通用的，我们会重点分析 PCB 走线上的信号完整性。

# Signal integrity issue

狭义的信号完整性问题分为两大类：

- 单一网络的信号失真
  - 阻抗不匹配导致的反射
  - 频率相关损耗造成互连线中的上升沿退化，出现信号质量问题
  - 时序错误（互连线电气特性差异、或长度差异引起的多个信号之间的时延差错位，会导致差分信号失真）
  - 噪声
- 两个或多个网络之间的串扰

# Reflection

反射产生的根本原因，是 **信号前进方向的瞬时阻抗发生改变**。有可能造成阻抗发生改变的源头：

- 走线改变方向/宽度，也比如走线分叉
- 断头线，所有的信号都会反射回去
- 通孔或过孔
- 信号不连续，例如走到器件管脚上

反射的来源有两种，阻抗突变处的反射和阻性负载的反射

---

如果沿着传输线走，任一位置横截面都相同，就称为均匀传输线，例如双绞线。这种传输线的阻抗是可控的。

为了最大限度地减少信号退化，信号应该沿路径或迹线看到恒定的阻抗。阻抗是一个点概念，因此不能保证走线中间的阻抗与走线开始或结束时的阻抗相同。

如果在任何一点存在阻抗不匹配或变化，这可能会导致反射，进而导致信号失真。

在 PCB 上有各种造成信号不匹配的因素：

- 走线改变方向/宽度，也比如走线分叉
- 断头线，所有的信号都会反射回去
- 通孔或过孔
- 信号不连续，例如走到器件管脚上
- 板材间的差异（不写）

反射的来源有两种，一种是阻抗突变处的反射，另一种是阻性负载的反射。

阻抗突变处的反射是指，当传输线上的瞬时阻抗发生突变，部分信号会沿着相反方向反射；而另一部分将继续传输，但那一部分的幅度会有所改变。我们定义反射系数为反射与入射信号幅值之比，假设第一个区域阻抗为 Z1，第二个区域为 Z2，那么：

$$
\rho=\frac{V_{reflected}}{V_{incident}}=\frac{Z_2-Z_1}{Z_2+Z_1}
$$

可见，两个区域阻抗相差越多，反射的信号量就越大。举个例子，如果 1V 的信号沿着特性阻抗为 50Ω 的传输线传播，进入特性阻抗为 75Ω 的区域时，反射系数算出来是 20%，所以反射回来的电压为 0.2V。

另一种是阻性负载的反射。我们知道三种极端的情况，如果传输线末端是开路，那么反射系数就无限接近 1，入射的信号会全部反射回来。如果是短路的话，末端阻抗就为 0，算出来的反射系数是-1，入射信号到达远端时，将产生 -1V 的反射信号，向源端传播，正负抵消后电压为 0。第三种就是阻抗匹配的情况，反射系数算出来是 0，信号不会反射回来。假设在 50Ω 阻抗下，那么我们可以得到这样一张关系图：

（图）

当区域 2 的阻抗小于区域 1 时，反射系数为负值，反射电压是负电压。假设终端阻性负载为 25Ω，那么反射系数为 -0.33，所以有 -0.33V 的电压被反射回源端，终端实际电压为 1+(-0.33)=0.67V。

反射长什么样子？（图）

反射的解决办法，是尽量让互连线的阻抗保持恒定。具体有以下措施：

1. 使用可控阻抗互连
2. 增加电阻匹配，参考做法是始端串电阻或者末端并电阻
3. 采用沿线拓扑的阻抗维持恒定的布线规则，最小化支路长度
4. 对线的几何特征进行精细设计，比如避免直角或锐角
5. PCB 布线避开干扰源和耦合路径

# Frequency response / attenuation

信号也可能会因为特定的频率衰减而失真。假如说各频率衰减是均匀的，那么最终的信号形状也不会变，但实际上衰减会因信号频率提高而增大，所以会发生失真现象。

频率相关的损耗，主要来源是导体本身的电阻。另外 pcb 材料本身的特性也会在不同的频率下产生不同的介电损耗

另一种损耗的形式是趋肤效应。就是？高频率电流在导体内分布不均匀，更趋向于导体的边缘。这种效应这反过来会产生随频率增加的自感，并导致额外的衰减。

增加走线的宽度以增加其总表面积可以减少趋肤效应造成的损耗，但改变走线形态也有可能产生阻抗不匹配的问题，这就需要在各种影响因素中做出妥协了。

# Crosstalk（动画）

串扰是指相邻导体或迹线之间的能量耦合？

通常我们分别称两条互连线为影响的和被影响的。

分为近端串扰和远端。

减小串扰的方法是：

- 增加走线间隔
- 尽量避免平行走线
- 靠近地平面

---

一根信号线上有信号通过时，在 PCB 板上与之相邻的信号线上就会感应出相关的信号，我们称之为串扰。串扰通常表现为毛刺。串扰是传输线之间相互的寄生电感产生耦合引发的，带来的危害是使信号畸变。

串扰分为近端（NEXT）串扰与远端串扰（FEXT）。（动画）

看wiki https://wiki-power.com/%E4%BF%A1%E5%8F%B7%E5%AE%8C%E6%95%B4%E6%80%A7-%E4%B8%B2%E6%89%B0/

# Noise

噪声大多是由电源引起的，关乎到电源完整性的问题。

抖动可以定义为信号时序的变化

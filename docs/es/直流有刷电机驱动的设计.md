# Diseño de control para motores de corriente continua con escobillas

Normalmente, utilizamos una modulación por ancho de pulso (PWM) para controlar un puente H y así gestionar la dirección y la velocidad de los motores de corriente continua con escobillas. La relación entre el ciclo de trabajo del PWM y la velocidad del motor es directamente proporcional.

## Fundamentos del puente H

Un puente H es un circuito en puente que permite invertir rápidamente la polaridad de la tensión en una carga. Este tipo de circuito se utiliza comúnmente para controlar motores de corriente continua con escobillas, permitiéndoles girar en sentido horario o antihorario. Debido a su estructura que se asemeja a la letra "H," se le llama puente H.

Un puente H consta de cuatro interruptores: S1 y S3 forman los interruptores de alta (High-Side Switch) del puente H, generalmente compuestos por transistores MOSFET tipo P o transistores bipolares PNP. S2 y S4 forman los interruptores de baja (Low-Side Switch) del puente H, generalmente compuestos por transistores MOSFET tipo N o transistores bipolares NPN.

![Puente H](https://img.wiki-power.com/d/wiki-media/img/20210812093751.png)

- Cuando los interruptores S1 y S4 están cerrados y los interruptores S2 y S3 están abiertos, el motor gira en sentido horario.
- Cuando los interruptores S2 y S3 están cerrados y los interruptores S1 y S4 están abiertos, el motor gira en sentido antihorario.
- Cuando los interruptores S1 y S2, o S3 y S4, están cerrados al mismo tiempo, se produce un cortocircuito en la fuente de alimentación, lo que puede dañarla. Esto se conoce como "shoot-through".
- Cuando los interruptores S1 y S3 están cerrados y los interruptores S2 y S4 están abiertos, o viceversa, el motor no gira. En este caso, el motor actúa como un "freno", ya que la fuerza contraelectromotriz generada por el movimiento inercial se cortocircuita, creando una fuerza de frenado.
- Cuando los cuatro interruptores S1, S2, S3 y S4 están abiertos, el motor se encuentra en estado de "planeo" y continuará girando debido a la inercia.

En la práctica, se utilizan chips controladores para gestionar con precisión los cuatro transistores MOS del puente H.

## Elección entre componentes discretos y chips integrados

En comparación con el uso de chips controladores integrados, la construcción de circuitos con componentes discretos es más económica y ofrece mayor flexibilidad. Por lo general, el control del motor comienza con una señal PWM generada por un microcontrolador, que pasa por un aislador óptico y una lógica antes de llegar al chip controlador, que a su vez controla los transistores MOS del puente completo o medio puente.

Sin embargo, la construcción de un controlador de motor con componentes discretos implica una serie de consideraciones adicionales, como el control de la zona muerta (para prevenir "shoot-through"), el diseño de una tensión de alimentación adecuada y la implementación de circuitos de protección. Esto aumenta la complejidad del diseño, el espacio ocupado en la PCB, los costos y el riesgo de diseño.

Por lo general, al controlar motores de corriente continua con escobillas, se prefieren los chips controladores de puente H integrados.

## Selección de transistores MOS

En la aplicación de control de motores, generalmente se eligen transistores MOSFET tipo N de potencia mejorada. Las razones son las siguientes:

1. Elección de MOSFET de potencia mejorada: estos dispositivos pueden apagarse por completo en niveles bajos de voltaje y pueden conducir completamente cuando el voltaje supera el umbral de encendido $U_{GS(TH)}$.
2. Elección de MOSFET tipo N: los MOSFET tipo P suelen tener menos opciones disponibles, son más caros y tienen una mayor resistencia de conducción, lo que conduce a una mayor generación de calor y menor eficiencia.
3. Elección de MOSFET: en comparación con los transistores bipolares (BJT), los MOSFET tienen una menor pérdida de potencia, son más compactos, requieren una corriente de activación más alta, tienen una respuesta más rápida y tienen una menor resistencia de conducción.

En la práctica, para simplificar la lista de materiales, generalmente se utilizan transistores MOSFET tipo N en todos los componentes. Sin embargo, dado que los transistores MOSFET tipo N no se pueden utilizar directamente en el control de alta tensión del puente H (debido a que la condición de activación de los MOSFET tipo N es $V_g-V_s>V_{gs(th)}$), se debe diseñar un circuito de alimentación flotante de alta tensión para controlar los transistores superiores. Para obtener más detalles sobre el circuito de alimentación flotante, consulte el artículo [**Diseño de alimentación - Circuito de alimentación flotante**](https://wiki-power.com/%E7%94%B5%E6%BA%90%E8%AE%BE%E8%AE%A1-%E8%87%AA%E4%B8%BE%E7%94%B5%E8%B7%AF).

Al seleccionar transistores MOSFET tipo N, es importante tener en cuenta los siguientes parámetros:

- $V_{DSS}$
- $R_{DS(on)}$

## Chips controladores de puente H integrados

Los chips controladores de puente H integrados suelen incluir una serie de circuitos de protección, como:

- Protección contra sobretensión (Over-Voltage Protection, OVP)
- Protección de bloqueo por baja tensión (Under-Voltage Lock-Out, UVLO)
- Protección contra sobrecorriente (Over-Current Protection, OCP)
- Protección contra apagado térmico (Thermal Shut-Down, TSD)
- Protección contra "shoot-through" (Shoot-Through Protection, STP)
- Protección contra descargas electrostáticas (ElectroStatic Discharge, ESD)

Por lo general, usamos un chip de controlador de puerta para suministrar energía a la compuerta de potencia N-MOS tanto en el lado de alta tensión como en el lado de baja tensión (según el manual de datos, debe mantenerse por encima de $U_{GS(TH)}$ del MOSFET para que conduzca entre el drenaje D y la fuente S). A modo de ejemplo, aquí están los parámetros del controlador de puerta DRV8701:

![Imagen](https://img.wiki-power.com/d/wiki-media/img/20210811095012.png)

Cuando se utiliza junto con el IRFH8330, puede controlar eficazmente este MOSFET:

![Imagen](https://img.wiki-power.com/d/wiki-media/img/20210811095429.png)

## Selección de la frecuencia de PWM

Al controlar la velocidad del motor con una señal PWM, es importante tener en cuenta su frecuencia. Si la frecuencia es demasiado baja, el motor generará ruido a bajas velocidades y la respuesta al cambio en el ciclo de trabajo será lenta. Por otro lado, si la frecuencia del PWM es demasiado alta, se producirán pérdidas de conmutación significativas en los MOSFET del puente H.

Si el datasheet del controlador del puente H no especifica un rango de frecuencia concreto, en general, las señales PWM de alrededor de 4 kHz a 200 kHz son ideales para controlar eficazmente la velocidad del motor.

## Inserción de tiempo muerto y protección de conducción cruzada (directa)

El tiempo muerto se puede entender como un retraso que asegura que el puente superior se apague por completo antes de encender el puente inferior al cambiar de dirección. Un tiempo muerto demasiado corto puede ser peligroso, mientras que uno muy largo puede afectar la respuesta del motor y reducir la eficiencia energética.

![Imagen](https://img.wiki-power.com/d/wiki-media/img/20210815112048.jpg)

Cuando se utiliza una solución integrada, se realiza un proceso de "apretón de manos" que garantiza el uso del tiempo muerto óptimo sin verse afectado por la velocidad de giro, el voltaje, las características de los MOSFET o la temperatura. El proceso de "apretón de manos" incluye los siguientes pasos:

1. Recibir la señal para cambiar del MOSFET superior al inferior de baja tensión.
2. Deshabilitar el MOSFET superior y monitorear $V_{GS}$ para determinar cuándo habilitarlo nuevamente.
3. Insertar el tiempo muerto y habilitar el MOSFET de baja tensión.

## Modo de degradación del puente H

El modo de degradación se refiere a cómo se disipa la energía y se detiene el motor. Dado que los motores de corriente continua son cargas inductivas (la corriente de inductancia no puede cambiar instantáneamente), para detener el motor, además de cortar la alimentación, es necesario proporcionar un camino de recirculación para disipar la energía del motor y evitar dañar los MOSFET.

### Degradación Asincrónica y Sincrónica

Se pueden utilizar diodos para construir un camino de recirculación, como se muestra en la imagen:

![Imagen](https://img.wiki-power.com/d/wiki-media/img/20211222162216.png)

Sin embargo, los MOSFET tienen diodos internos que pueden actuar como caminos de recirculación en algunas aplicaciones, y a veces se agregan diodos Schottky en paralelo. Este método se conoce como degradación asincrónica. Sin embargo, la degradación asincrónica puede tener pérdidas relativamente altas ($2*I*V_D$). Esto nos lleva a otro enfoque llamado degradación sincrónica. La degradación sincrónica utiliza la apertura de los MOSFET para crear un camino de recirculación. Debido a la baja resistencia de conducción $R_{ds(on)}$ de los MOSFET, las pérdidas en la degradación sincrónica son relativamente bajas ($I^2*R_{ds(on)}$). A continuación, se describirá principalmente la degradación sincrónica.

![Imagen](https://img.wiki-power.com/d/wiki-media/img/20211222172558.png)

### Parámetros Clave

![Imagen](https://img.wiki-power.com/d/wiki-media/img/20211222172913.png)

- $I_{TRIP}$: Corriente establecida por el chip de control actual, controlada por el algoritmo de control.
- $T_{DRIVE}$: Tiempo de la etapa de conducción.
- $T_{BLANK}$: Tiempo de la etapa de tiempo muerto, para evitar la posibilidad de conducción cruzada.
- $T_{OFF$]: Tiempo de la etapa de recirculación.

### Tres modos de degradación sincrónica

La degradación sincrónica tiene tres modos: degradación rápida (Fast Decay), degradación lenta (Slow Decay) y degradación mixta (Mixed Decay). La rapidez o lentitud se refiere a la velocidad relativa de disminución de corriente durante la etapa de recirculación y no a la velocidad del motor. Las diferencias entre los tres modos son las siguientes:

|                        | Decaimiento Rápido         | Decaimiento Lento         | Decaimiento Mixto         |
| ---------------------- | --------------------------- | -------------------------- | ------------------------ |
| Ondulación de Corriente Fase   | Alta                      | Baja                      | Moderada                 |
| Tiempo de Etapa OFF $T_{OFF}$ | Corto (puede causar mayor pérdida de conmutación) | Largo (puede generar ruido de baja frecuencia) | Moderado (equilibrio entre frecuencia y rendimiento) |
| Velocidad de Disminución de Corriente Fase | Rápida                  | Lenta                      | Moderada                 |
| Aplicabilidad            | Adecuado para motores con gran inductancia | Adecuado para motores con poca inductancia | Moderado                |

#### Decaimiento Rápido

![](https://img.wiki-power.com/d/wiki-media/img/20211223154627.png)

El proceso de decaimiento rápido implica cerrar los dos transistores MOS del controlador, esperar el tiempo muerto y luego abrir los dos transistores MOS simétricamente para permitir que la corriente se disipe rápidamente. Durante el tiempo muerto, el puente H experimentará un decaimiento asimétrico, pero su duración es tan breve que puede pasarse por alto.

#### Decaimiento Lento

![](https://img.wiki-power.com/d/wiki-media/img/20211223160616.png)

El proceso de decaimiento lento implica cerrar los dos transistores MOS del controlador, esperar el tiempo muerto y luego abrir los dos transistores MOS inferiores para permitir que la corriente se disipe lentamente. Del mismo modo, durante el tiempo muerto, el puente H experimentará un decaimiento asimétrico, pero su duración es tan breve que puede pasarse por alto.

#### Decaimiento Mixto

El proceso de decaimiento mixto implica cerrar los dos transistores MOS del controlador, esperar el tiempo muerto y luego abrir los dos transistores MOS simétricamente (decaimiento rápido) para permitir que la corriente se disipe rápidamente; luego abrir los dos transistores MOS inferiores (decaimiento lento) para permitir que la corriente se disipe lentamente. En el modo de decaimiento mixto, la ondulación de corriente de fase se encuentra entre el decaimiento rápido y el decaimiento lento.

## Problemas de EMC en la Accionamiento de Motores y su Solución

Dado que el motor de corriente continua es una carga inductiva (la corriente de inductancia no puede cambiar abruptamente), para evitar la aparición de rebotes o picos inestables en el voltaje del motor cuando se desactiva el puente H, se puede colocar un gran condensador (>100μF, generalmente uno electrolítico de aluminio) en la fuente de voltaje del motor. Este condensador se utiliza para absorber la corriente de inercia generada al detener el motor de corriente continua y estabilizar la fuente de voltaje del motor durante los cambios de dirección.

Otro problema es la impedancia parásita entre la fuente de voltaje del motor y las líneas de alimentación de la placa de control del motor (inductancia + resistencia) que junto con la capacitancia parásita de la PCB, forman un tanque LC resonante. Cuando se suministra energía desde la fuente de voltaje del motor a la placa de control del motor, si la capacitancia local de derivación es insuficiente, el voltaje del motor puede caer rápidamente, lo que puede provocar la excitación del resonante LC y picos oscilatorios. Para reducir los picos causados por la resonancia LC de las líneas de alimentación, se puede agregar un condensador de derivación de 0.1μF (generalmente uno de cerámica) cerca de los pines de alimentación del puente H del motor.

Un ejemplo de referencia:

![](https://img.wiki-power.com/d/wiki-media/img/20211222150738.png)

Además, es posible agregar anillos de ferrita en las líneas del motor para reducir las interferencias comunes (comprobado experimentalmente).

## Referencias y Agradecimientos

- [Circuito de control de puente completo compuesto por 4 N-MOS](https://www.fanyedu.com/content/90.html)
- [Explicación detallada sobre el diseño de motores con escobillas en la competencia ROBOCON](https://zhuanlan.zhihu.com/p/27547384)
- [Discusión superficial sobre circuitos de control de motores con escobillas de corriente continua](https://haipeng.me/2021/02/28/h-bridge-driver/)
- [Modos de Decaimiento Lento, Mixto y Rápido. ¿Por qué complicar las cosas?](https://ebldc.com/?p=86)
- [Dominio de la corriente de recirculación y los modos de decaimiento en el control de motores](https://www.ti.com.cn/cn/lit/an/zhcaa31/zhcaa31.pdf)
- [Recirculación de Corriente y Modos de Decaimiento](https://www.ti.com/lit/an/slva321a/slva321a.pdf)

[por_reemplazar[1]]
[por_reemplazar[2]]

> Este post está traducido usando ChatGPT, por favor [**feedback**](https://github.com/linyuxuanlin/Wiki_MkDocs/issues/new) si hay alguna omisión.